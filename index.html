<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pp pawfact ç‹—ç‹—å€‹äººåŒ–é®®é£Ÿé¡§å•</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        :root {
            --primary-color: #00695C;
            --secondary-color: #00897B;
            --accent-color: #FFC107;
            --bg-color: #F5F7FA;
            --text-color: #333;
            --light-gray: #E0E0E0;
            --white: #FFFFFF;
            --protein-color: #3498DB;
            --fat-color: #F1C40F;
            --carb-color: #E67E22;
            --danger-color: #D32F2F;
            --success-color: #2E7D32;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--white);
            padding: 20px 30px 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 20px;
        }

        header h1 {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 28px;
            margin: 0;
        }

        header p {
            font-size: 16px;
            color: #666;
            margin-top: 5px;
        }
        
        .profile-manager {
            background-color: #E8F5E9;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        .profile-manager .profile-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .profile-manager label {
            font-weight: 500;
            font-size: 15px;
        }
        .profile-manager select, .profile-manager button {
            padding: 8px 12px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            cursor: pointer;
        }
        .profile-manager button.save-btn {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            color: #333;
            font-weight: 500;
        }
        #profile-message {
            font-size: 13px;
            color: var(--primary-color);
            font-weight: 500;
        }


        .form-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s;
            background-color: var(--white);
        }
        
        .form-group select:disabled {
            background-color: #f2f2f2;
            cursor: not-allowed;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(0, 137, 123, 0.2);
        }

        .option-group {
            display: flex;
            gap: 15px;
            align-items: center;
            padding-top: 5px;
        }

        .option-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: 400;
        }

        .option-group input[type="radio"],
        .allergen-group input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }
        
        .allergen-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border: 1px solid var(--light-gray);
        }
        .allergen-group label {
            font-size: 14px;
            cursor: pointer;
        }
        
        #recipe-warning {
            color: var(--danger-color);
            font-size: 14px;
            font-weight: 500;
            margin-top: 8px;
            height: 1em; /* Reserve space to prevent layout shift */
        }

        .calculate-btn {
            grid-column: 1 / -1;
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 105, 92, 0.3);
        }

        #result-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px dashed var(--light-gray);
            display: none; /* Initially hidden */
        }
        
        .result-actions {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .print-btn {
            padding: 8px 16px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .print-btn:hover {
            background-color: var(--primary-color);
        }

        .recipe-card {
            border: 1px solid var(--primary-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .recipe-header {
            background-color: var(--primary-color);
            color: var(--white);
            text-align: center;
            padding: 0;
        }
        #recipe-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            display: block;
        }
        .recipe-header-content {
            padding: 20px;
        }
        .recipe-header h2 { margin: 0; font-size: 22px; font-weight: 700; }
        #recipe-target-issue { display: inline-block; background-color: rgba(255, 255, 255, 0.15); border-radius: 15px; padding: 6px 15px; font-size: 15px; margin-top: 12px; border: 1px solid rgba(255, 255, 255, 0.3); }
        #recipe-target-issue svg { vertical-align: middle; margin-right: 5px; margin-bottom: 2px; }
        #recipe-subtitle { margin: 10px 0 0; opacity: 0.9; font-size: 14px; }
        #recipe-special-note { background-color: var(--danger-color); color: white; padding: 10px 15px; margin: 15px auto 0; border-radius: 6px; font-size: 14px; font-weight: 500; max-width: 90%; }

        .recipe-body { padding: 25px; }
        .result-subsection { margin-bottom: 30px; }
        .result-subsection h3 { display: flex; align-items: center; font-size: 18px; color: var(--primary-color); margin-top: 0; margin-bottom: 15px; }
        .result-subsection h3 svg { margin-right: 10px; flex-shrink: 0; }

        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; text-align: center; }
        .summary-item { background-color: var(--bg-color); padding: 15px; border-radius: 8px; }
        .summary-item .label { font-size: 14px; color: #555; }
        .summary-item .value { font-size: 20px; font-weight: 700; color: var(--primary-color); }
        
        .pie-chart-container { display: flex; gap: 20px; align-items: center; }
        .pie-chart { width: 150px; height: 150px; border-radius: 50%; background: conic-gradient(var(--protein-color) 0% 40%, var(--fat-color) 40% 75%, var(--carb-color) 75% 100%); flex-shrink: 0; }
        .pie-legend { display: flex; flex-direction: column; gap: 10px; }
        .legend-item { display: flex; align-items: center; font-size: 14px; }
        .legend-color { width: 16px; height: 16px; border-radius: 4px; margin-right: 10px; }
        .legend-label { font-weight: 500; }
        .legend-value { margin-left: auto; padding-left: 15px; text-align: right; }
        .legend-grams { font-size: 12px; color: #777; }

        table { width: 100%; border-collapse: collapse; font-size: 15px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
        th { background-color: #E8F5E9; font-weight: 500; }
        
        .supplements-table td { font-size: 14px; }
        .supplements-table .warning { color: #E65100; font-weight: bold; display: block; margin-top: 5px; }
        
        .instructions h4 {
            font-size: 16px;
            font-weight: 700;
            color: var(--secondary-color);
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .instructions ol { list-style-type: none; padding-left: 0; }
        .instructions li { display: flex; align-items: flex-start; margin-bottom: 15px; padding: 10px; background-color: #fafafa; border-radius: 5px; border-left: 3px solid var(--secondary-color); }
        .instructions .step-number { background-color: var(--secondary-color); color: white; font-weight: bold; border-radius: 50%; min-width: 28px; height: 28px; display: flex; justify-content: center; align-items: center; margin-right: 15px; flex-shrink: 0; }
        .instructions .step-content { line-height: 1.6; }
        
        #purchase-suggestion-section, .combo-recommendation-section {
            padding: 20px;
            background: linear-gradient(135deg, #e0f2f1, #f1f8e9);
            border: 1px solid var(--primary-color);
            border-radius: 8px;
        }
        .combo-recommendation-section { background: linear-gradient(135deg, #fff3e0, #fbe9e7); border-color: var(--accent-color); margin-top: 20px; }
        .purchase-card { display: flex; gap: 20px; align-items: center; }
        .purchase-image { width: 120px; height: 120px; border-radius: 8px; flex-shrink: 0; object-fit: cover; border: 1px solid #ddd; }
        .purchase-details { flex-grow: 1; }
        .purchase-details h4 { margin: 0 0 5px 0; font-size: 18px; color: var(--primary-color); }
        .purchase-details .desc { font-size: 14px; color: #555; margin-bottom: 15px; }
        .purchase-controls { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        .quantity-selector { display: flex; align-items: center; border: 1px solid #ccc; border-radius: 5px; }
        .quantity-selector button { width: 30px; height: 30px; border: none; background-color: #f0f0f0; cursor: pointer; font-size: 18px; }
        .quantity-selector .quantity { width: 40px; text-align: center; font-weight: bold; font-size: 16px; }
        .total-price { font-size: 18px; font-weight: bold; color: var(--danger-color); }
        .add-to-list-btn {
            padding: 10px 20px;
            background-color: var(--accent-color);
            border: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-left: auto;
        }

        .batch-calculator { padding: 20px; background-color: #E8F5E9; border-radius: 8px; }
        .batch-controls { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
        .batch-controls label { font-weight: 500; }
        .batch-controls input { width: 80px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .batch-controls button { padding: 8px 16px; background-color: var(--primary-color); color: white; border:none; border-radius: 5px; cursor: pointer; }
        #batch-result { font-size: 14px; }
        #batch-result ul { padding-left: 20px; margin: 0; }
        
        .snack-calculator { padding: 20px; background-color: #FFF3E0; border-radius: 8px; }
        .snack-controls { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .snack-controls select, .snack-controls input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        .snack-controls button { padding: 8px 16px; background-color: var(--accent-color); color: #333; border:none; border-radius: 5px; cursor: pointer; font-weight: 500; }
        #snack-result { margin-top: 15px; font-weight: 500; }
        #snack-result .safe { color: var(--success-color); }
        #snack-result .danger { color: var(--danger-color); }
        
        .rotation-suggestion ul { list-style: none; padding: 0; display: flex; gap: 15px; flex-wrap: wrap; }
        .rotation-suggestion button { background-color: #f0f0f0; border: 1px solid #ccc; padding: 10px 15px; border-radius: 8px; cursor: pointer; text-align: left; width: 100%; transition: background-color 0.2s, border-color 0.2s; }
        .rotation-suggestion button:hover { background-color: #e0e0e0; border-color: #aaa; }
        .rotation-suggestion button strong { display: block; font-size: 16px; color: var(--primary-color); }
        .rotation-suggestion button span { font-size: 13px; color: #555; }

        .disclaimer { margin-top: 30px; padding: 15px; background-color: #FFF3E0; border-left: 5px solid #FF9800; font-size: 14px; line-height: 1.7; }
        .disclaimer strong { color: #E65100; }
        
        .email-capture-section {
            margin-top: 40px;
            padding: 25px;
            background-color: #E8F5E9;
            border-radius: 8px;
            text-align: center;
        }
        .email-capture-section h4 { margin: 0 0 10px 0; font-size: 18px; color: var(--primary-color); }
        .email-capture-section p { margin: 0 0 20px 0; color: #555; font-size: 14px; }
        #email-capture-form { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        #email-input {
            width: 100%;
            max-width: 300px;
            padding: 12px;
            border: 1px solid var(--light-gray);
            border-radius: 6px;
            font-size: 16px;
        }
        #email-submit-btn {
            padding: 12px 25px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        .footer-notes { text-align: center; font-size: 12px; color: #999; margin-top: 40px; }
        .footer-notes .toggle-sources { color: var(--primary-color); cursor: pointer; text-decoration: underline; font-weight: 500; }
        .sources-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; text-align: left; background: #f9f9f9; padding: 0 20px; margin-top: 10px; border-radius: 5px; font-size: 13px; }
        .sources-content.show { max-height: 500px; padding: 15px 20px; }
        .sources-content ul { padding-left: 20px; }

        #shopping-list-icon { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background-color: var(--primary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000; transition: transform 0.2s; }
        #shopping-list-icon:hover { transform: scale(1.1); }
        #shopping-list-icon svg { color: white; width: 32px; height: 32px; }
        #shopping-list-icon .badge { position: absolute; top: -5px; right: -5px; background-color: var(--danger-color); color: white; border-radius: 50%; width: 24px; height: 24px; font-size: 14px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
        
        #shopping-list-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1001; display: none; align-items: center; justify-content: center; }
        #shopping-list-modal.show { display: flex; }
        .list-modal-content { background-color: white; border-radius: 10px; width: 90%; max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; }
        .list-modal-header { padding: 15px 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .list-modal-header h3 { margin: 0; font-size: 20px; color: var(--primary-color); }
        .list-modal-header .close-btn { font-size: 24px; border: none; background: none; cursor: pointer; }
        .list-modal-body { padding: 20px; overflow-y: auto; }
        .list-item { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .list-item:last-child { border-bottom: none; margin-bottom: 0; }
        .list-item-name { flex-grow: 1; font-weight: 500; }
        .list-item-price { color: #555; width: 80px; text-align: right; }
        .list-item-remove { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 12px; text-decoration: underline; }
        .list-modal-footer { padding: 20px; border-top: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; background-color: #f9f9f9; }
        .list-total-price { font-size: 20px; font-weight: bold; }
        .checkout-btn { padding: 12px 25px; background-color: var(--accent-color); border: none; border-radius: 5px; font-weight: bold; font-size: 16px; cursor: pointer; }
        #empty-list-msg { text-align: center; color: #888; }

        @media print {
            body { padding: 0; background-color: white; }
            .container { box-shadow: none; border: none; padding: 0; max-width: 100%; }
            header, form, .profile-manager, .result-actions, #purchase-suggestion-section, .combo-recommendation-section, .email-capture-section, .batch-calculator, .snack-calculator, .rotation-suggestion, .disclaimer, .footer-notes, #shopping-list-icon, #shopping-list-modal { display: none; }
            #result-section { display: block !important; margin-top: 0; padding-top: 0; border-top: none; }
            .recipe-card { border: none; }
            .recipe-body { padding: 0; }
            h3 { margin-top: 20px; }
        }

        @media (max-width: 768px) {
            .form-section { grid-template-columns: 1fr; }
            .container { padding: 20px; }
            header h1 { font-size: 24px; }
            .pie-chart-container { flex-direction: column; text-align: center; }
            .pie-legend { width: 100%; }
            .legend-value { text-align: left; }
            #recipe-image { height: 200px; }
            .purchase-card { flex-direction: column; }
            .add-to-list-btn { width: 100%; margin-left: 0; margin-top: 15px; }
            .responsive-table thead { display: none; }
            .responsive-table tr { display: block; margin-bottom: 1.5em; border: 1px solid #ddd; border-radius: 5px; padding: 10px; }
            .responsive-table td { display: block; text-align: right; border: none; padding-left: 50%; position: relative; padding-top: 8px; padding-bottom: 8px; }
            .responsive-table td::before { content: attr(data-label); position: absolute; left: 10px; width: calc(50% - 20px); text-align: left; font-weight: bold; color: var(--primary-color); }
        }
    </style>
</head>
<body>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script>
// â† YOUR CONFIG HERE â†“
const firebaseConfig = {
  apiKey: "AIzaSyAH1vDSk0CGzGwobDwPo0Kl0dB6dhKeNvk",
  authDomain: "pprecipe-pay-auth.firebaseapp.com",
  projectId: "pprecipe-pay-auth",
  storageBucket: "pprecipe-pay-auth.firebasestorage.app",
  messagingSenderId: "741698236045",
  appId: "1:741698236045:web:fcb73fe358747d4b3e7cc4"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// LOGIN BOX
const loginHTML = `
  <div id="login-box" style="margin:20px;padding:15px;background:#e8f5e9;border-radius:8px;border:1px solid #00695c;">
    <h3>Log In to Unlock Recipes</h3>
    <input id="login-email" placeholder="Email" style="width:100%;margin:5px 0;padding:8px;">
    <input id="login-pass" type="password" placeholder="Password" style="width:100%;margin:5px 0;padding:8px;">
    <button onclick="signUp()">Sign Up</button>
    <button onclick="logIn()">Log In</button>
    <button onclick="logOut()" id="logout-btn" style="display:none;">Log Out</button>
    <p id="login-msg" style="color:red;"></p>
  </div>`;
document.body.insertAdjacentHTML('afterbegin', loginHTML);

// [rest of login functions from earlier]
</script>
    
    <div class="container">
        <header>
            <h1>pp pawfact ç‹—ç‹—å€‹äººåŒ–é®®é£Ÿé¡§å•</h1>
            <p>ç®¡ç†ç‹—ç‹—æª”æ¡ˆã€è¨ˆç®—é›¶é£Ÿç†±é‡ã€è¼ªæ›¿é£Ÿè­œï¼Œæ‰“é€ å…¨æ–¹ä½å¥åº·è¨ˆç•«</p>
        </header>

        <div id="profile-manager" class="profile-manager">
            <div class="profile-controls">
                <label for="profile-select">ç‹—ç‹—æª”æ¡ˆ:</label>
                <select id="profile-select">
                    <option value="">-- è¼‰å…¥å·²å­˜æª”çš„ç‹—ç‹— --</option>
                </select>
            </div>
            <button id="save-profile-btn" class="save-btn">å„²å­˜ç›®å‰ç‹—ç‹—è³‡æ–™</button>
            <span id="profile-message"></span>
        </div>

        <form id="dog-form" class="form-section">
            <div class="form-group full-width">
                <label for="health-issue">1. ä¸»è¦å¥åº·ç›®æ¨™</label>
                <select id="health-issue" name="health-issue" required>
                    <option value="" disabled selected>-- é»æ­¤é¸æ“‡ --</option>
                    <option value="general">ç„¡ç‰¹å®šå•é¡Œ / æ—¥å¸¸ä¿å¥</option>
                    <option value="weight_loss">é«”é‡éé‡ / æ¸›é‡éœ€æ±‚</option>
                    <option value="performance">é«˜æ´»å‹•é‡ / å¢è‚Œéœ€æ±‚</option>
                    <option value="joint">é—œç¯€ä¿é¤Š / è¡Œå‹•ä¸ä¾¿</option>
                    <option value="skin">çš®è†šæ•æ„Ÿ / æ”ç™¢</option>
                    <option value="coat">æ¯›é«®ä¹¾ç‡¥ / ç¼ºä¹å…‰æ¾¤</option>
                    <option value="gi_health">è…¸èƒƒæ•æ„Ÿ / æ¶ˆåŒ–ä¸è‰¯</option>
                    <option value="urinary">æ³Œå°¿é“å•é¡Œ</option>
                    <option value="heart">å¿ƒè‡Ÿä¿å¥</option>
                    <option value="tear_stain">æ·šç—•å•é¡Œ</option>
                    <option value="eye_health">çœ¼ç›ä¿å¥</option>
                    <option value="senior">é«˜é½¡çŠ¬ç¶œåˆä¿å¥</option>
                    <option value="puppy">å¹¼çŠ¬ç™¼è‚²æˆé•·</option>
                    <option value="respiratory">å‘¼å¸é“ / æ°£ç®¡ä¿é¤Š</option>
                </select>
            </div>
            
            <div class="form-group full-width">
                <label>2. è«‹å‹¾é¸éœ€è¦é¿é–‹çš„éæ•åŸ (å¯è¤‡é¸)</label>
                <div id="allergen-filter" class="allergen-group"></div>
            </div>

            <div class="form-group full-width">
                <label for="recipe-choice">3. æ¨è–¦é£Ÿè­œ (å·²éæ¿¾éæ•åŸ)</label>
                <select id="recipe-choice" name="recipe-choice" required disabled>
                    <option value="" disabled selected>-- è«‹å…ˆé¸æ“‡å¥åº·ç›®æ¨™ --</option>
                </select>
                <div id="recipe-warning"></div>
            </div>
            
            <div class="form-group">
                <label for="dog-name">4. ç‹—ç‹—çš„åå­—</label>
                <input type="text" id="dog-name" name="dog-name" placeholder="ä¾‹å¦‚ï¼šæ—ºè²¡" required>
            </div>
            <div class="form-group">
                <label for="dog-age">ç‹—ç‹—å¹´é½¡ (æ­²)</label>
                <input type="number" id="dog-age" name="dog-age" placeholder="ä¾‹å¦‚ï¼š5" step="0.1" min="0.1" required>
            </div>
            <div class="form-group">
                <label for="dog-weight">ç‹—ç‹—é«”é‡ (å…¬æ–¤)</label>
                <input type="number" id="dog-weight" name="dog-weight" placeholder="ä¾‹å¦‚ï¼š5.2" step="0.1" min="0.5" required>
            </div>
            
            <div class="form-group">
                <label for="activity-level">é«”æ…‹èˆ‡æ´»å‹•é‡ (DERä¿‚æ•¸)</label>
                <select id="activity-level" name="activity-level">
                    <option value="1.0">éé‡/éœ€æ¸›é‡</option>
                    <option value="1.2">ä½æ´»å‹•é‡/æ˜“èƒ–é«”è³ª</option>
                    <option value="1.4">é«˜é½¡çŠ¬/æ´»å‹•é‡åä½</option>
                    <option value="1.6" selected>å·²çµ•è‚²æˆçŠ¬/æ­£å¸¸æ´»å‹•</option>
                    <option value="1.8">æœªçµ•è‚²æˆçŠ¬/æ­£å¸¸æ´»å‹•</option>
                    <option value="2.0">é«˜æ´»å‹•é‡/å·¥ä½œçŠ¬</option>
                    <option value="2.5">å¹¼çŠ¬ (4-12å€‹æœˆ)</option>
                    <option value="3.0">å¹¼çŠ¬ (&lt;4å€‹æœˆ)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ˜¯å¦çµ•è‚²ï¼Ÿ</label>
                <div class="option-group">
                    <label><input type="radio" name="neutered" value="yes" checked> æ˜¯</label>
                    <label><input type="radio" name="neutered" value="no"> å¦</label>
                </div>
            </div>
            
            <div class="form-group">
                <label>æ¯æ—¥é¤µé£Ÿé¤æ•¸</label>
                <select id="meals-per-day" name="meals-per-day">
                    <option value="2">2 é¤</option>
                    <option value="3">3 é¤</option>
                </select>
            </div>

            <button type="submit" class="calculate-btn">ç”¢ç”Ÿå°ˆå±¬é£Ÿè­œ</button>
        </form>

        <div id="result-section">
            <div class="result-actions">
                <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ å‹å–„åˆ—å° / å„²å­˜ç‚ºPDF</button>
            </div>
            <div class="recipe-card">
                <div class="recipe-header">
                    <img id="recipe-image" src="" alt="é£Ÿè­œæˆå“ç…§ç‰‡">
                    <div class="recipe-header-content">
                        <h2 id="recipe-title"></h2>
                        <div id="recipe-target-issue"></div>
                        <p id="recipe-subtitle"></p>
                        <div id="recipe-special-note" style="display: none;"></div>
                    </div>
                </div>
                <div class="recipe-body">
                    <div class="result-subsection">
                        <h3>... æ¯æ—¥é¤µé£Ÿè¨ˆç•« ...</h3>
                        <div class="summary-grid">
                            <div class="summary-item"><div class="label">æ¯æ—¥æ‰€éœ€ç†±é‡</div><div class="value" id="daily-calories"></div></div>
                            <div class="summary-item"><div class="label">æ¯æ—¥ç¸½é¤µé£Ÿé‡</div><div class="value" id="daily-food-weight"></div></div>
                            <div class="summary-item"><div class="label">æ¯é¤ä»½é‡</div><div class="value" id="meal-portion"></div></div>
                        </div>
                    </div>
                    
                    <div class="result-subsection">
                        <h3>... å·¨é‡ç‡Ÿé¤Šç´ åˆ†æ ...</h3>
                        <div class="pie-chart-container">
                            <div id="macro-pie-chart" class="pie-chart"></div>
                            <div id="macro-pie-legend" class="pie-legend"></div>
                        </div>
                    </div>

                    <div class="result-subsection">
                        <h3>... æ¯æ—¥é£Ÿæä»½é‡ ...</h3>
                        <table id="ingredients-table" class="responsive-table">
                            <thead><tr><th>é£Ÿæ</th><th>ä»½é‡(å…‹)</th><th>åŠŸæ•ˆèˆ‡ä½œç”¨</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    
                    <div id="purchase-suggestion-section" class="result-subsection">
                        <h3>... å°ˆå±¬å‡ä¹¾é›¶é£ŸåŠ è³¼ ...</h3>
                        <p style="font-size:14px; color:#555; margin-top: -10px;">æ ¹æ“šé€™ä»½é£Ÿè­œçš„è›‹ç™½è³ªä¾†æºï¼Œæˆ‘å€‘ç‚º <strong id="purchase-dog-name"></strong> æ¨è–¦æœ€é©åˆçš„å‡ä¹¾é›¶é£Ÿï¼</p>
                        <div id="purchase-suggestion-content"></div>
                        <div id="combo-recommendation-content"></div>
                    </div>
                    
                    <div class="result-subsection">
                        <h3>... æ‰¹é‡è£½ä½œè¨ˆç®—æ©Ÿ ...</h3>
                        <div class="batch-calculator">
                            <div class="batch-controls">
                                <label for="batch-days">æˆ‘æƒ³ä¸€æ¬¡è£½ä½œ</label>
                                <input type="number" id="batch-days" value="7" min="1">
                                <label for="batch-days">å¤©çš„ä»½é‡</label>
                                <button id="calculate-batch-btn">è¨ˆç®—ç¸½é‡</button>
                            </div>
                            <div id="batch-result"></div>
                        </div>
                    </div>

                    <div class="result-subsection">
                        <h3>... é›¶é£Ÿç†±é‡å½±éŸ¿è©•ä¼° ...</h3>
                        <div class="snack-calculator">
                            <div class="snack-controls">
                                <select id="snack-select"></select>
                                <input type="number" id="snack-quantity" value="1" min="1">
                                <span id="snack-unit">ä»½</span>
                                <button id="calculate-snack-btn">è©•ä¼°å½±éŸ¿</button>
                            </div>
                            <div id="snack-result"></div>
                        </div>
                    </div>
                    
                    <div class="result-subsection instructions">
                        <h3>... è£½ä½œæ­¥é©Ÿ ...</h3>
                        <h4>æ–¹æ³•ä¸€ï¼šæº«å’Œè’¸ç…®æ³• (æ¨è–¦)</h4>
                        <ol>
                            <li><div class="step-number">1</div><div class="step-content"><strong>æº–å‚™é£Ÿæï¼š</strong>å°‡æ‰€æœ‰é£ŸææŒ‰è¡¨å–®é‡é‡æº–å‚™å¥½ã€‚è‚‰é¡åˆ‡å¡Šï¼›æ‰€æœ‰è”¬æœå»çš®åˆ‡ä¸ï¼›è‡é¡åˆ‡ç¢ã€‚</div></li>
                            <li><div class="step-number">2</div><div class="step-content"><strong>æº«å’Œè’¸ç…®ï¼š</strong>å°‡è‚‰é¡å’Œæ‰€æœ‰è”¬æœæ”¾å…¥è€ç†±ç¢—ä¸­ï¼Œç”¨é›»é‹æˆ–è’¸é‹è’¸ç…®ç´„20åˆ†é˜ï¼Œç›´åˆ°æ‰€æœ‰é£Ÿæéƒ½ç†Ÿé€è»Ÿçˆ›ã€‚</div></li>
                        </ol>
                        
                        <h4>æ–¹æ³•äºŒï¼šé¦™æ°£æ‹Œç‚’æ³• (å¯é¸)</h4>
                        <ol>
                            <li><div class="step-number">1</div><div class="step-content"><strong>æº–å‚™é£Ÿæï¼š</strong>åŒè’¸ç…®æ³•ã€‚</div></li>
                            <li><div class="step-number">2</div><div class="step-content"><strong>é–‹å§‹æ‹Œç‚’ï¼š</strong>åœ¨é‹ä¸­åŠ å…¥å°‘é‡çŠ¬éš»å¯é£Ÿç”¨çš„æ²¹(å¦‚æ¤°å­æ²¹ã€æ©„æ¬–æ²¹)ï¼Œç†±é‹å¾Œå…ˆä¸‹è‚‰é¡ï¼Œç‚’è‡³ç´„ä¸ƒåˆ†ç†Ÿã€‚</div></li>
                            <li><div class="step-number">3</div><div class="step-content"><strong>åŠ å…¥è”¬èœï¼š</strong>åŠ å…¥è³ªåœ°è¼ƒç¡¬çš„è”¬èœ(å¦‚èƒ¡è˜¿è””)æ‹Œç‚’ï¼Œå†åŠ å…¥è³ªåœ°è¼ƒè»Ÿçš„è”¬èœï¼Œå¯åŠ å…¥å°‘é‡æ°´å¹«åŠ©è»ŸåŒ–ï¼Œç…®è‡³æ‰€æœ‰é£Ÿæç†Ÿé€ã€‚</div></li>
                        </ol>

                        <h4>å…±åŒé—œéµæ­¥é©Ÿ (ç„¡è«–ä½¿ç”¨ä½•ç¨®æ–¹æ³•)</h4>
                        <ol>
                            <li><div class="step-number" style="background-color: var(--danger-color);">!</div><div class="step-content" style="border-left-color: var(--danger-color);"><strong><span style="color: #E65100;">é—œéµæ­¥é©Ÿï¼šé™æº«ï¼</span></strong>å‹™å¿…å°‡ç…®å¥½çš„é®®é£Ÿå®Œå…¨æ”¾æ¶¼è‡³å®¤æº«(ç´„38Â°Cä»¥ä¸‹)ï¼Œæ‘¸èµ·ä¾†ä¸ç‡™æ‰‹ç‚ºæ­¢ã€‚ç†±é£Ÿæœƒç ´å£è£œå……å“çš„ç‡Ÿé¤Šã€‚</div></li>
                            <li><div class="step-number" style="background-color: var(--danger-color);">!</div><div class="step-content" style="border-left-color: var(--danger-color);"><strong>æ·»åŠ ç‡Ÿé¤Šï¼š</strong>åœ¨å®Œå…¨å†·å»çš„é®®é£Ÿä¸­ï¼Œæ‹Œå…¥æ‰€æœ‰ã€Œå¿…éœ€ç‡Ÿé¤Šè£œå……å“ã€ã€‚æ”ªæ‹Œå‡å‹»ï¼Œå³å¯é¤µé£Ÿï¼</div></li>
                        </ol>
                    </div>

                    <div class="result-subsection">
                        <h3>... å¿…éœ€ç‡Ÿé¤Šè£œå……å“ (æ¯æ—¥ä»½é‡) ...</h3>
                        <table id="supplements-table" class="responsive-table supplements-table">
                            <thead><tr><th>è£œå……å“</th><th>å»ºè­°ä»½é‡</th><th>èªªæ˜</th><th>å¤©ç„¶é£Ÿææ›ç®—åƒè€ƒ</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="result-subsection rotation-suggestion">
                        <h3>... å»ºè­°çš„è¼ªæ›¿é£Ÿè­œ ...</h3>
                        <p style="font-size:14px; color:#555; margin-top: -10px;">å®šæœŸè¼ªæ›¿ä¸åŒè›‹ç™½è³ªä¾†æºçš„é£Ÿè­œï¼Œæœ‰åŠ©æ–¼ç‡Ÿé¤Šå‡è¡¡ä¸¦é™ä½é£Ÿç‰©ä¸è€çš„é¢¨éšªã€‚ä»¥ä¸‹æ˜¯å…¶ä»–ç¬¦åˆæ‚¨è¨­å®šçš„å¥åº·ç›®æ¨™èˆ‡éæ•åŸç¯©é¸çš„é£Ÿè­œï¼š</p>
                        <ul id="rotation-list"></ul>
                    </div>

                    <div class="disclaimer">
                        <strong>é‡è¦æé†’ï¼š</strong>
                        <ul>
                            <li>æœ¬è¨ˆç®—çµæœç‚ºåŸºæ–¼æ¨™æº–å…¬å¼çš„ä¼°ç®—å€¼ï¼Œä¸èƒ½å–ä»£å°ˆæ¥­ç¸é†«å¸«æˆ–å¯µç‰©ç‡Ÿé¤Šå¸«çš„å»ºè­°ã€‚</li>
                            <li>æ¯éš»ç‹—ç‹—çš„ä»£è¬ç‡å’Œæ´»å‹•é‡å‡æœ‰å·®ç•°ï¼Œè«‹åœ¨é–‹å§‹æ–°é£Ÿè­œå¾Œï¼Œæ¯é€±ç›£æ§ç‹—ç‹—çš„é«”é‡å’Œèº«é«”ç‹€æ³ï¼Œä¸¦é©æ™‚å¾®èª¿ä»½é‡ã€‚</li>
                            <li><strong>è›‹æ®¼ç²‰ã€é­šæ²¹å’Œç¶œåˆç¶­ç”Ÿç´ æ˜¯ç¢ºä¿è‡ªè£½é®®é£Ÿç‡Ÿé¤Šå‡è¡¡çš„å¿…éœ€å“ï¼Œä¸å¯çœç•¥ã€‚</strong></li>
                            <li>æ›´æ›é£Ÿè­œæ™‚è«‹æ¡æ¼¸é€²å¼ï¼Œç”¨7-10å¤©æ™‚é–“é€æ­¥æ›¿æ›ï¼Œä»¥å…è…¸èƒƒä¸é©ã€‚</li>
                        </ul>
                    </div>

                    <div class="email-capture-section">
                        <h4>è¦ºå¾—é€™ä»½è¨ˆç•«å¾ˆæ£’å—ï¼Ÿ</h4>
                        <p>è¼¸å…¥æ‚¨çš„ Emailï¼Œæˆ‘å€‘æœƒå°‡é€™ä»½å°ˆå±¬å¥åº·è¨ˆç•«å¯„çµ¦æ‚¨ï¼Œæ–¹ä¾¿éš¨æ™‚æŸ¥é–±ï¼</p>
                        <form id="email-capture-form">
                            <input type="email" id="email-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„ Email" required>
                            <button type="submit" id="email-submit-btn">è¨‚é–±ä¸¦æ¥æ”¶è¨ˆç•«</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="footer-notes">
            <p><a href="javascript:void(0);" id="toggle-sources-btn" class="toggle-sources">é»æ­¤å±•é–‹/æ”¶åˆ è¨ˆç®—ä¾æ“šèˆ‡åƒè€ƒè³‡æ–™</a></p>
            <div id="sources-content" class="sources-content">
                <p><strong>å°ˆæ¥­å¯©æ ¸ï¼š</strong>æœ¬ç³»çµ±ä¹‹è¨ˆç®—é‚è¼¯èˆ‡é£Ÿè­œå»ºè­°ï¼Œç”± pp pawfact å¯µç‰©ç‡Ÿé¤Šé¡§å•åŸºæ–¼å…¬é–‹çš„ç¸é†«ç‡Ÿé¤Šå­¸æ¨™æº–ç”Ÿæˆï¼Œç›®çš„ç‚ºæä¾›é£¼ä¸»æ•™è‚²èˆ‡åƒè€ƒï¼Œä¸èƒ½å–ä»£å°ˆæ¥­è¨ºæ–·ã€‚</p>
                <p><strong>è¨ˆç®—ä¾æ“šï¼š</strong></p>
                <ul>
                    <li><strong>éœæ…‹èƒ½é‡éœ€æ±‚ (RER):</strong> <code>70 * (é«”é‡kg)^0.75</code>ã€‚æ­¤ç‚ºçŠ¬è²“æœ€å»£æ³›ä½¿ç”¨çš„åŸºç¤ä»£è¬è¨ˆç®—å…¬å¼ã€‚</li>
                    <li><strong>æ¯æ—¥èƒ½é‡éœ€æ±‚ (DER):</strong> <code>RER * DERä¿‚æ•¸</code>ã€‚DERä¿‚æ•¸åƒè€ƒç¾åœ‹åœ‹å®¶ç§‘å­¸ç ”ç©¶å§”å“¡æœƒ(NRC)èˆ‡ç¸é†«è‡¨åºŠæ‰‹å†Šçš„å»ºè­°å€¼ï¼Œç¶œåˆäº†çŠ¬éš»çš„å¹´é½¡ã€æ´»å‹•é‡ã€çµ•è‚²ç‹€æ…‹èˆ‡é«”æ…‹ç›®æ¨™ã€‚</li>
                </ul>
                <p><strong>ç‡Ÿé¤Šè£œå……å“åƒè€ƒï¼š</strong></p>
                <ul>
                    <li>éˆ£è³ªèˆ‡é­šæ²¹çš„å»ºè­°é‡ï¼Œåƒè€ƒäº†è‡ªè£½é®®é£Ÿçš„é€šç”¨å®‰å…¨æº–å‰‡ï¼Œæ—¨åœ¨å¹³è¡¡éˆ£ç£·æ¯”èˆ‡è£œå……Omega-3è„‚è‚ªé…¸ã€‚</li>
                    <li>ç‰¹æ®Šè£œå……å“ï¼ˆå¦‚ç‰›ç£ºé…¸ã€è‘¡è„ç³–èƒºï¼‰çš„å»ºè­°ï¼ŒåŸºæ–¼ç›¸é—œç ”ç©¶æ–‡ç»ä¸­å°ç‰¹å®šå¥åº·ç‹€æ³çš„æ”¯æŒåŠ‘é‡ã€‚</li>
                </ul>
            </div>
        </footer>
    </div>

    <div id="shopping-list-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 18c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm0-3l1.1-2h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4.96c.34-.65-.11-1.46-.83-1.46H5.21L4.27 2H2v2h2l3.6 7.59L7.42 15H17v-2H7z"/></svg>
        <span class="badge" id="shopping-list-badge" style="display: none;">0</span>
    </div>

    <div id="shopping-list-modal">
        <div class="list-modal-content">
            <div class="list-modal-header">
                <h3>pp pawfact æ¡è³¼æ¸…å–®</h3>
                <button class="close-btn" id="list-modal-close-btn">&times;</button>
            </div>
            <div class="list-modal-body" id="list-modal-body">
                <p id="empty-list-msg">æ‚¨çš„æ¡è³¼æ¸…å–®æ˜¯ç©ºçš„ã€‚</p>
            </div>
            <div class="list-modal-footer">
                <div class="list-total-price" id="list-total-price">ç¸½è¨ˆ: NT$ 0</div>
                <button class="checkout-btn" id="checkout-btn">å‰å¾€çµå¸³</button>
            </div>
        </div>
    </div>


    <script>
        // --- DATA LIBRARIES ---
        const recipes = {
            // --- NEW RECIPE: Autumn Pear & Rabbit Therapeutic Soup ---
            autumn_pear_rabbit_soup: {
                id: 'autumn_pear_rabbit_soup',
                name: "ç§‹ç‡¥æ¢¨æ±å…”è‚‰é¤ (è¼”é¤)",
                primaryTarget: "ç§‹å­£æ½¤ç‡¥èˆ‡å‘¼å¸é“ä¿å¥",
                description: "ä¸€ä»½æº«å’Œæ»‹æ½¤çš„å­£ç¯€æ€§é£Ÿç™‚è¼”é¤ï¼Œé¸ç”¨ä½æ•å…”è‚‰æ­é…å¤šç¨®æ½¤è‚ºé£Ÿæï¼Œå¹«åŠ©èˆ’ç·©ç§‹ç‡¥å¼•èµ·çš„ä¸é©ã€‚",
                caloriesPerGram: 1.0, // Low calorie density due to high water content
                tags: ['respiratory', 'general'],
                macros: { protein: 45, fat: 20, carbs: 35 },
                specialNote: "ã€é‡è¦ã€‘æ­¤ç‚ºè¼”åŠ©é£Ÿç™‚é¤ï¼Œéä¸»é£Ÿã€‚å…¶ç†±é‡èˆ‡ç‡Ÿé¤Šç´ ä¸ç¬¦åˆä¸»é£Ÿæ¨™æº–ï¼Œåƒ…å¯ä½œç‚ºä¸»é£Ÿçš„å°‘é‡æ·»åŠ ï¼Œä»½é‡ä¸æ‡‰è¶…éæ¯æ—¥ç¸½é¤µé£Ÿé‡çš„10%ã€‚",
                imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#FDF4E3"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#B9770E">ç§‹æ½¤å…”è‚‰é¤</text></svg>')}`,
                ingredients: [
                    { name: "å…”è‚‰", percentage: 0.40, note: "æ¥µä½æ•çš„æ–°ç©è›‹ç™½è³ªï¼Œæ€§æ¶¼ï¼Œé©åˆé«”è³ªç‡¥ç†±æˆ–éœ€è¦é¿é–‹å¸¸è¦‹éæ•åŸçš„çŠ¬éš»ã€‚", allergen_id: 'rabbit' },
                    { name: "é›ªæ¢¨", percentage: 0.10, note: "å¯Œå«æ°´åˆ†ï¼Œæœ‰åŠ©æ–¼æ»‹æ½¤å‘¼å¸é“ï¼Œç·©è§£ä¹¾ç‡¥ã€‚å‹™å¿…å»æ ¸ã€‚", },
                    { name: "ç™½è˜¿è””", percentage: 0.10, note: "æœ‰åŠ©æ–¼ç†æ°£æ¶ˆé£Ÿï¼Œå…¶å¤©ç„¶é…µç´ èƒ½å¹«åŠ©æ¶ˆåŒ–ã€‚", },
                    { name: "å†¬ç“œ", percentage: 0.10, note: "é«˜å«æ°´é‡ã€ä½ç†±é‡ï¼Œæœ‰åŠ©æ–¼è£œå……æ°´åˆ†èˆ‡æ¸…ç†±ã€‚", },
                    { name: "èŒ­ç™½", percentage: 0.10, note: "å¯Œå«æ°´åˆ†èˆ‡çº–ç¶­ï¼Œæœ‰åŠ©æ–¼è…¸é“è •å‹•ã€‚", },
                    { name: "è“®å­ (ä¹¾ç‡¥)", percentage: 0.08, note: "æœ‰åŠ©æ–¼å¥è„¾å®‰ç¥ï¼Œä½¿ç”¨å‰éœ€æ³¡ç™¼ä¸¦å»èŠ¯ã€‚", },
                    { name: "ç™½æ‰è±† (ä¹¾ç‡¥)", percentage: 0.08, note: "æœ‰åŠ©æ–¼å¥è„¾åŒ–æ¿•ï¼Œä½¿ç”¨å‰éœ€å……åˆ†æ³¡ç™¼ã€‚", },
                    { name: "éŠ€è€³ (ä¹¾ç‡¥)", percentage: 0.04, note: "å¯Œå«æ¤ç‰©è† è³ªï¼Œæ˜¯å‚³çµ±çš„æ½¤è‚ºé£Ÿæã€‚ä½¿ç”¨å‰éœ€å……åˆ†æ³¡ç™¼ã€‚", }
                    // æ¡‚èŠ±èˆ‡èœ‚èœœå› ä»½é‡æ¥µå°‘ä¸”ç‚ºå¾Œæ·»åŠ ï¼Œä¸è¨ˆå…¥ä¸»è¦ç™¾åˆ†æ¯”
                ]
            },
            // --- End of New Recipe ---
            weight_loss_recipe: { id: 'weight_loss_recipe', name: "æ¤°æ±ç«é›ä½è„‚é¤", primaryTarget: "é«”é‡ç®¡ç†èˆ‡æ¸›é‡", description: "å°ˆç‚ºé«”é‡ç®¡ç†è¨­è¨ˆï¼Œåˆ©ç”¨é«˜çº–ç¶­é£Ÿæå‰µé€ é£½è¶³æ„Ÿï¼ŒåŒæ™‚ä»¥å„ªè³ªè›‹ç™½ç¶­æŒæ´»åŠ›ã€‚", caloriesPerGram: 1.1, tags: ['weight_loss', 'general'], macros: { protein: 40, fat: 35, carbs: 25 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#F5B041"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">ç«é›ä½è„‚é¤</text></svg>')}`, ingredients: [ { name: "å»çš®ç«é›èƒ¸è‚‰", percentage: 0.50, note: "æä¾›é«˜å“è³ªã€ä½è„‚è‚ªçš„å‹•ç‰©æ€§è›‹ç™½è³ªï¼Œæ˜¯ç¶­æŒè‚Œè‚‰é‡ã€ä¿ƒé€²æ–°é™³ä»£è¬çš„åŸºç¤ã€‚", allergen_id: 'turkey' }, { name: "é¦¬éˆ´è–¯", percentage: 0.15, note: "å¯Œå«æŠ—æ€§æ¾±ç²‰çš„å„ªè³ªç¢³æ°´åŒ–åˆç‰©ï¼Œå¯æä¾›ç©©å®šèƒ½é‡èˆ‡é£½è¶³æ„Ÿï¼Œæœ‰ç›Šè…¸é“èŒå¢ã€‚" }, { name: "å±±è—¥", percentage: 0.10, note: "å«æœ‰é»æ¶²è›‹ç™½ï¼Œæœ‰åŠ©æ–¼ä¿è­·è…¸èƒƒé“é»è†œï¼Œå…¶è–¯è•·çš‚ç´ äº¦æœ‰åŠ©æ–¼èª¿ç¯€ç”Ÿç†æ©Ÿèƒ½ã€‚" }, { name: "ä½›æ‰‹ç“œ", percentage: 0.10, note: "æ¥µä½ç†±é‡ã€é«˜å«æ°´é‡çš„è”¬èœï¼Œèƒ½å¢åŠ é£Ÿç‰©é«”ç©èˆ‡é£½è¶³æ„Ÿï¼ŒåŒæ™‚è£œå……æ°´åˆ†ã€‚" }, { name: "ç¶œåˆè‡é¡", percentage: 0.05, note: "å¯Œå«Î²-è‘¡èšé†£ç­‰å¤šé†£é«”ï¼Œæœ‰åŠ©æ–¼èª¿ç¯€å…ç–«ç³»çµ±åŠŸèƒ½ï¼Œä¸¦æä¾›å¤šç¨®å¾®é‡å…ƒç´ ã€‚" }, { name: "é»ƒè˜¿è””", percentage: 0.05, note: "Î²-èƒ¡è˜¿è””ç´ çš„è‰¯å¥½ä¾†æºï¼Œå¯åœ¨é«”å…§è½‰åŒ–ç‚ºç¶­ç”Ÿç´ Aï¼Œå°è¦–åŠ›ä¿å¥è‡³é—œé‡è¦ã€‚" }, { name: "ç„¡ç³–æ¤°æ¼¿", percentage: 0.05, note: "æä¾›ä¸­éˆè„‚è‚ªé…¸(MCT)ï¼Œå¯ä½œç‚ºå¿«é€Ÿèƒ½é‡ä¾†æºï¼Œä¸¦å¢åŠ é£Ÿè­œé¢¨å‘³ã€‚" } ] },
            respiratory_recipe: { id: 'respiratory_recipe', name: "æ°£ç®¡èˆ’æ½¤é›è‚‰ç‡‰èœ", primaryTarget: "å‘¼å¸é“èˆ‡æ°£ç®¡èˆ’æ½¤", description: "ä¸€é“æº«å’Œæ»‹æ½¤çš„é£Ÿç™‚ç‡‰èœï¼Œç²¾é¸å°å‘¼å¸ç³»çµ±æœ‰ç›Šçš„é£Ÿæï¼Œèˆ’ç·©æ°£ç®¡ä¸é©ã€‚", caloriesPerGram: 1.2, tags: ['respiratory', 'senior'], macros: { protein: 40, fat: 30, carbs: 30 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#FAD7A0"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#A0522D">æ°£ç®¡èˆ’æ½¤é¤</text></svg>')}`, ingredients: [ { name: "å»çš®é›èƒ¸è‚‰", percentage: 0.50, note: "æº«å’Œã€æ˜“æ¶ˆåŒ–çš„å„ªè³ªè›‹ç™½è³ªï¼Œç‚ºèº«é«”æä¾›å¿…éœ€èƒºåŸºé…¸ï¼Œæ”¯æŒæ•´é«”å¥åº·ã€‚", allergen_id: 'chicken' }, { name: "æ°´æ¢¨", percentage: 0.15, note: "å¯Œå«æ°´åˆ†èˆ‡å¤©ç„¶é…µç´ ï¼Œæœ‰åŠ©æ–¼æ»‹æ½¤å‘¼å¸é“é»è†œï¼Œç·©è§£ä¹¾ç‡¥å¼•èµ·çš„ä¸é©ã€‚" }, { name: "å±±è—¥", percentage: 0.15, note: "å‚³çµ±é£Ÿç™‚ä¸­å¸¸ç”¨æ–¼å¥è„¾ç›Šè‚ºï¼Œå…¶é»æ¶²è›‹ç™½æœ‰åŠ©æ–¼ä¿è­·æ¶ˆåŒ–é“èˆ‡å‘¼å¸é“é»è†œã€‚" }, { name: "éŠ€è€³ (ç™½æœ¨è€³)", percentage: 0.10, note: "å¯Œå«æ¤ç‰©æ€§è† è³ªèˆ‡å¤šé†£é«”ï¼Œæœ‰åŠ©æ–¼ä¿æ¿•æ½¤ç‡¥ï¼Œå°å‘¼å¸é“å¥åº·æœ‰ç›Šã€‚" }, { name: "å—ç“œ", percentage: 0.10, note: "æä¾›è±å¯Œçš„Î²-èƒ¡è˜¿è””ç´ ï¼Œæ˜¯å¼·æ•ˆæŠ—æ°§åŒ–åŠ‘ï¼Œæœ‰åŠ©æ–¼ä¿è­·ç´°èƒå…æ–¼æ°§åŒ–æå‚·ã€‚" } ] },
            joint_recipe: { id: 'joint_recipe', name: "é®­é­šé›è‚‰é—œç¯€é¤", primaryTarget: "é—œç¯€ä¿å¥èˆ‡éˆæ´»æ€§ç¶­è­·", description: "å°ˆç‚ºé—œç¯€è¨­è¨ˆçš„ã€è¡Œå‹•åŠ›åŠ å¼·é¤ã€ï¼ŒçµåˆæŠ—ç™¼ç‚åŠè»Ÿéª¨ä¿®å¾©çš„é—œéµé£Ÿæã€‚", caloriesPerGram: 1.25, tags: ['joint', 'senior'], macros: { protein: 35, fat: 45, carbs: 20 }, specialSupplements: ['glucosamine'], recommendedSupplements: ['sup_gl'], imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#82E0AA"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">é—œç¯€ä¿å¥é¤</text></svg>')}`, ingredients: [ { name: "ç¶ å”‡è²", percentage: 0.10, note: "å¤©ç„¶è‘¡è„ç³–èƒºèˆ‡è»Ÿéª¨ç´ çš„æ¥µä½³ä¾†æºï¼Œæ˜¯æ§‹æˆé—œç¯€è»Ÿéª¨åŠæ»‘æ¶²çš„é—œéµæˆåˆ†ï¼Œæœ‰åŠ©æ–¼ç¶­æŒé—œç¯€æ´»å‹•åŠ›ã€‚" }, { name: "é›è‚‰", percentage: 0.35, note: "æä¾›å»ºæ§‹è‚Œè‚‰æ‰€éœ€çš„é«˜å“è³ªè›‹ç™½è³ªï¼Œå¼·å¥çš„è‚Œè‚‰èƒ½æ›´å¥½åœ°æ”¯æ’å’Œä¿è­·é—œç¯€ã€‚", allergen_id: 'chicken' }, { name: "é®­é­š", percentage: 0.20, note: "å¯Œå«Omega-3è„‚è‚ªé…¸(EPA/DHA)ï¼Œå…·æœ‰å¼·å¤§çš„æŠ—ç™¼ç‚æ•ˆæœï¼Œæœ‰åŠ©æ–¼ç·©è§£é—œç¯€ä¸é©ã€‚", allergen_id: 'fish' }, { name: "åœ°ç“œ", percentage: 0.20, note: "å¯Œå«æŠ—æ°§åŒ–ç‰©Î²-èƒ¡è˜¿è””ç´ åŠç¶­ç”Ÿç´ Cï¼Œæœ‰åŠ©æ–¼å°æŠ—é«”å…§è‡ªç”±åŸºï¼Œæ¸›ç·©é—œç¯€è€åŒ–ã€‚" }, { name: "é’èŠ±èœ", percentage: 0.15, note: "å«æœ‰è˜¿è””ç¡«ç´ ï¼Œæ˜¯ä¸€ç¨®å¼·æ•ˆæŠ—æ°§åŒ–åŠ‘ï¼Œä¸¦æä¾›ç¶­ç”Ÿç´ Kï¼Œå°éª¨éª¼å¥åº·æœ‰é—œéµä½œç”¨ã€‚" } ] },
            heart_recipe: { id: 'heart_recipe', name: "è­·å¿ƒç«é›æ²™ä¸é­šé¤", primaryTarget: "å¿ƒè¡€ç®¡ç³»çµ±å¥åº·æ”¯æŒ", description: "ç‚ºå®ˆè­·æœ€é‡è¦çš„ã€å¿ƒã€è€Œè¨­è¨ˆï¼Œå¯Œå«ç‰›ç£ºé…¸ã€CoQ10å’ŒOmega-3çš„è­·å¿ƒé¥—å®´ã€‚", caloriesPerGram: 1.2, tags: ['heart', 'senior'], macros: { protein: 38, fat: 42, carbs: 20 }, specialSupplements: ['taurine'], imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#E74C3C"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">å¿ƒè‡Ÿä¿å¥é¤</text></svg>')}`, ingredients: [ { name: "ç«é›èƒ¸è‚‰", percentage: 0.30, note: "å¯Œå«ç‰›ç£ºé…¸çš„ä½è„‚è›‹ç™½è³ªï¼Œç‰›ç£ºé…¸æ˜¯ç¶­æŒå¿ƒè‚Œæ­£å¸¸åŠŸèƒ½ä¸å¯æˆ–ç¼ºçš„èƒºåŸºé…¸ã€‚", allergen_id: 'turkey' }, { name: "æ²™ä¸é­š", percentage: 0.25, note: "Omega-3è„‚è‚ªé…¸å’Œè¼”é…¶Q10çš„çµ•ä½³ä¾†æºï¼Œæœ‰åŠ©æ–¼å¿ƒè¡€ç®¡ä¿å¥èˆ‡æä¾›å¿ƒè‚Œç´°èƒèƒ½é‡ã€‚", allergen_id: 'fish' }, { name: "ç™½ç±³", percentage: 0.20, note: "æä¾›æ˜“æ–¼æ¶ˆåŒ–å¸æ”¶çš„ç¢³æ°´åŒ–åˆç‰©ï¼Œä½œç‚ºç´”æ·¨çš„èƒ½é‡ä¾†æºï¼Œé¿å…é€ æˆèº«é«”é¡å¤–è² æ“”ã€‚", allergen_id: 'grain' }, { name: "è èœ", percentage: 0.15, note: "å¯Œå«é‰€å’Œé‚ï¼Œé€™å…©ç¨®ç¤¦ç‰©è³ªå°æ–¼ç¶­æŒæ­£å¸¸å¿ƒå¾‹å’Œè¡€å£“è‡³é—œé‡è¦ã€‚" }, { name: "èƒ¡è˜¿è””", percentage: 0.10, note: "æä¾›Î²-èƒ¡è˜¿è””ç´ ï¼Œä½œç‚ºæŠ—æ°§åŒ–åŠ‘ä¿è­·è¡€ç®¡å…§çš®ç´°èƒï¼Œæ¸›å°‘æ°§åŒ–æå‚·ã€‚" } ] },
            urinary_recipe: { id: 'urinary_recipe', name: "æ³Œå°¿é“é›è‚‰æ°´æ½¤é¤", primaryTarget: "æ³Œå°¿é“å¥åº·ç¶­è­·", description: "é€éã€å¤šå–æ°´ã€å¤šæ’å°¿ã€çš„é£Ÿç™‚æ¦‚å¿µï¼Œæ‰“é€ ä¸åˆ©å£èŒç”Ÿé•·çš„æ³Œå°¿é“ç’°å¢ƒã€‚", caloriesPerGram: 1.15, tags: ['urinary'], macros: { protein: 45, fat: 25, carbs: 30 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#5DADE2"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">æ³Œå°¿é“ä¿å¥é¤</text></svg>')}`, ingredients: [ { name: "å»çš®é›èƒ¸è‚‰", percentage: 0.50, note: "å„ªè³ªçš„ä½ç£·è›‹ç™½è³ªï¼Œæœ‰åŠ©æ–¼åœ¨ç¶­æŒç‡Ÿé¤Šçš„åŒæ™‚ï¼Œæ¸›å°‘è…è‡Ÿçš„è² æ“”ã€‚", allergen_id: 'chicken' }, { name: "å†¬ç“œ", percentage: 0.20, note: "é«˜å«æ°´é‡è”¬èœï¼Œæœ‰åŠ©æ–¼å¢åŠ å°¿é‡ï¼Œç‰©ç†æ€§åœ°æ²–åˆ·æ³Œå°¿é“ï¼Œç¶­æŒæ½”æ·¨ã€‚" }, { name: "ç¯€ç“œ (å¤å—ç“œ)", percentage: 0.15, note: "å¯Œå«æ°´åˆ†ä¸”è‰é…¸é¹½å«é‡ä½ï¼Œæœ‰åŠ©æ–¼ç¨€é‡‹å°¿æ¶²ï¼Œé™ä½ç‰¹å®šé¡å‹çµçŸ³å½¢æˆçš„é¢¨éšªã€‚" }, { name: "ç„¡ç³–è”“è¶Šè“", percentage: 0.05, note: "å«æœ‰Aå‹åŸèŠ±é’ç´ (PACs)ï¼Œèƒ½æŠ‘åˆ¶ç´°èŒé™„è‘—æ–¼æ³Œå°¿é“å£ï¼Œæ˜¯æ³Œå°¿é“ä¿å¥çš„æ˜æ˜Ÿé£Ÿæã€‚" }, { name: "ç™½ç±³", percentage: 0.10, note: "æä¾›ç´”æ·¨ã€ä½æ•çš„èƒ½é‡ï¼Œé¿å…è¤‡é›œæˆåˆ†å°æ³Œå°¿ç³»çµ±é€ æˆåˆºæ¿€ã€‚", allergen_id: 'grain' } ] },
            senior_recipe: { id: 'senior_recipe', name: "é»ƒé‡‘æ­²æœˆé®­é­šé›è‚‰é¤", primaryTarget: "é«˜é½¡çŠ¬ç¶œåˆä¿å¥", description: "å°ˆç‚ºé»ƒé‡‘æ­²æœˆè¨­è¨ˆçš„å…¨æ–¹ä½ç‡Ÿé¤Šé¤ï¼Œæ˜“æ¶ˆåŒ–ã€é«˜æŠ—æ°§åŒ–ï¼Œå®ˆè­·å¤§è…¦ã€é—œç¯€èˆ‡å¿ƒè‡Ÿã€‚", caloriesPerGram: 1.2, tags: ['senior', 'heart', 'joint', 'eye_health'], macros: { protein: 35, fat: 40, carbs: 25 }, specialSupplements: ['glucosamine', 'taurine'], recommendedSupplements: ['sup_gl'], imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#D4AF37"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">é«˜é½¡çŠ¬ç¶œåˆé¤</text></svg>')}`, ingredients: [ { name: "é®­é­š", percentage: 0.25, note: "Omega-3 (DHA)æ˜¯è…¦ç´°èƒèˆ‡è¦–ç¶²è†œçš„é‡è¦æˆåˆ†ï¼Œæœ‰åŠ©æ–¼é«˜é½¡çŠ¬çš„èªçŸ¥èˆ‡è¦–åŠ›ä¿å¥ã€‚", allergen_id: 'fish' }, { name: "å»çš®é›èƒ¸è‚‰", percentage: 0.25, note: "æä¾›æ˜“æ¶ˆåŒ–çš„å„ªè³ªè›‹ç™½è³ªï¼Œå¹«åŠ©é«˜é½¡çŠ¬ç¶­æŒè‚Œè‚‰é‡ï¼Œé¿å…è‚Œå°‘ç—‡ã€‚", allergen_id: 'chicken' }, { name: "å—ç“œ", percentage: 0.20, note: "å¯Œå«çº–ç¶­æœ‰åŠ©æ–¼è…¸é“è •å‹•ï¼Œå…¶æŠ—æ°§åŒ–ç‰©Î²-èƒ¡è˜¿è””ç´ å‰‡èƒ½å°æŠ—è€åŒ–å¸¶ä¾†çš„ç´°èƒæå‚·ã€‚" }, { name: "è—è“", percentage: 0.10, note: "å¯Œå«èŠ±é’ç´ ç­‰å¼·åŠ›æŠ—æ°§åŒ–ç‰©ï¼Œæœ‰åŠ©æ–¼ä¿è­·è…¦ç¥ç¶“ç´°èƒï¼Œå»¶ç·©èªçŸ¥åŠŸèƒ½é€€åŒ–ã€‚" }, { name: "è èœ", percentage: 0.10, note: "æä¾›è‘‰é»ƒç´ ã€ç¶­ç”Ÿç´ KåŠå¤šç¨®ç¤¦ç‰©è³ªï¼Œå°çœ¼ç›ã€éª¨éª¼å’Œå¿ƒè¡€ç®¡ç³»çµ±å‡æœ‰ç›Šè™•ã€‚" }, { name: "ç‡•éº¥", percentage: 0.10, note: "å¯Œå«æ°´æº¶æ€§çº–ç¶­Î²-è‘¡èšé†£ï¼Œæœ‰åŠ©æ–¼ç©©å®šè¡€ç³–å’Œç¶­æŒå¿ƒè¡€ç®¡å¥åº·ã€‚", allergen_id: 'grain' } ] },
            puppy_recipe: { id: 'puppy_recipe', name: "é»ƒé‡‘ç™¼è‚²ç‰›é›é¤", primaryTarget: "å¹¼çŠ¬ç™¼è‚²æˆé•·", description: "ç‚ºç”Ÿå‘½èµ·è·‘ç·šæ³¨å…¥æ»¿æ»¿èƒ½é‡ï¼é«˜è›‹ç™½ã€é«˜ç†±é‡ï¼Œæ”¯æŒå¤§è…¦ã€è¦–åŠ›èˆ‡éª¨éª¼çš„é»ƒé‡‘ç™¼è‚²æœŸã€‚", caloriesPerGram: 1.4, tags: ['puppy', 'performance'], macros: { protein: 35, fat: 45, carbs: 20 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#FFC0CB"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#A0522D">å¹¼çŠ¬ç™¼è‚²é¤</text></svg>')}`, ingredients: [ { name: "é›è…¿è‚‰", percentage: 0.30, note: "æä¾›è±å¯Œçš„è›‹ç™½è³ªèˆ‡è„‚è‚ªï¼Œæ˜¯å¹¼çŠ¬å¿«é€Ÿæˆé•·æ‰€éœ€èƒ½é‡å’Œè‚Œè‚‰å»ºæ§‹çš„åŸºç¤ã€‚", allergen_id: 'chicken' }, { name: "ç‰›çµè‚‰ (ç˜¦)", percentage: 0.25, note: "å¯Œå«éµã€é‹…å’Œç¶­ç”Ÿç´ Bç¾¤ï¼Œå°æ–¼ç´…è¡€çƒç”Ÿæˆã€å…ç–«ç³»çµ±ç™¼å±•è‡³é—œé‡è¦ã€‚", allergen_id: 'beef' }, { name: "é›è›‹ (å…¨è›‹)", percentage: 0.10, note: "å®Œç¾çš„è›‹ç™½è³ªä¾†æºï¼Œè›‹é»ƒä¸­çš„è†½é¹¼æ˜¯è…¦éƒ¨ç¥ç¶“ç³»çµ±ç™¼è‚²çš„é—œéµç‡Ÿé¤Šç´ ã€‚", allergen_id: 'egg' }, { name: "åœ°ç“œ", percentage: 0.15, note: "æä¾›è¤‡åˆå¼ç¢³æ°´åŒ–åˆç‰©ï¼Œç©©å®šåœ°é‡‹æ”¾èƒ½é‡ï¼Œæ”¯æŒå¹¼çŠ¬çš„é«˜æ´»å‹•åŠ›éœ€æ±‚ã€‚" }, { name: "èƒ¡è˜¿è””", percentage: 0.10, note: "è±å¯Œçš„ç¶­ç”Ÿç´ Aå‰é©…ç‰©(Î²-èƒ¡è˜¿è””ç´ )ï¼Œå°è¦–åŠ›ã€çš®è†šå’Œå…ç–«ç³»çµ±çš„æ­£å¸¸ç™¼è‚²ä¸å¯æˆ–ç¼ºã€‚" }, { name: "é®­é­šæ²¹", percentage: 0.10, note: "DHAæ˜¯ä¿ƒé€²å¹¼çŠ¬å¤§è…¦å’Œè¦–ç¶²è†œç™¼è‚²çš„é»ƒé‡‘ç‡Ÿé¤Šç´ ï¼Œè®“ç‹—ç‹—æ›´è°æ˜ã€çœ¼ç›æ›´æ˜äº®ã€‚", allergen_id: 'fish' } ] },
            gi_health_recipe: { id: 'gi_health_recipe', name: "è…¸èƒƒèˆ’ç·©é›è‚‰é¤", primaryTarget: "è…¸èƒƒæ•æ„Ÿ / æ¶ˆåŒ–ä¸è‰¯", description: "çµ¦æ•æ„Ÿè…¸èƒƒä¸€å€‹æº«æŸ”çš„æ“æŠ±ã€‚æ¥µç°¡ã€ä½æ•ã€æ˜“æ¶ˆåŒ–çš„é…æ–¹ï¼Œè®“è…¸èƒƒå¥½å¥½ä¼‘æ¯å†å‡ºç™¼ã€‚", caloriesPerGram: 1.2, tags: ['gi_health', 'general'], macros: { protein: 40, fat: 20, carbs: 40 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#E8F8F5"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#1ABC9C">è…¸èƒƒèˆ’ç·©é¤</text></svg>')}`, ingredients: [ { name: "å»çš®é›èƒ¸è‚‰", percentage: 0.50, note: "å–®ä¸€ã€ä½è„‚çš„è›‹ç™½è³ªä¾†æºï¼Œæ˜“æ–¼æ¶ˆåŒ–ï¼Œå¯æ¸›å°‘è…¸èƒƒè² æ“”ï¼Œé©åˆè…¸èƒƒæ•æ„Ÿæ™‚æœŸã€‚", allergen_id: 'chicken' }, { name: "å—ç“œ", percentage: 0.25, note: "æä¾›è±å¯Œçš„å¯æº¶æ€§èˆ‡ä¸å¯æº¶æ€§çº–ç¶­ï¼Œæœ‰åŠ©æ–¼èª¿ç¯€è…¸é“è •å‹•ï¼Œæ”¹å–„ä¾¿ç§˜æˆ–è…¹ç€‰ã€‚" }, { name: "ç™½ç±³", percentage: 0.15, note: "ç…®ç†Ÿçš„ç™½ç±³æ˜¯æ¥µæ˜“æ¶ˆåŒ–çš„ç¢³æ°´åŒ–åˆç‰©ï¼Œèƒ½å¿«é€Ÿæä¾›èƒ½é‡ï¼ŒåŒæ™‚æœ‰åŠ©æ–¼ç³ä¾¿æˆå½¢ã€‚", allergen_id: 'grain' }, { name: "é«˜éº—èœ", percentage: 0.10, note: "å«æœ‰å¤©ç„¶çš„ç¶­ç”Ÿç´ U (S-ç”²åŸºç”²ç¡«æ°¨é…¸)ï¼Œæœ‰åŠ©æ–¼ä¿è­·å’Œä¿®å¾©è…¸èƒƒé“é»è†œã€‚" } ] },
            coat_recipe: { id: 'coat_recipe', name: "ç¾æ¯›äº®æ¾¤é®­é­šé¤", primaryTarget: "æ¯›é«®ä¹¾ç‡¥ / ç¼ºä¹å…‰æ¾¤", description: "æ‰“é€ ä¸€ä»¶é–ƒé–ƒå‹•äººçš„ã€æ¯›å¤§è¡£ã€ï¼å¯Œå«é—œéµè„‚è‚ªé…¸èˆ‡ç‡Ÿé¤Šç´ ï¼Œè®“æ¯›é«®ç”±å…§è€Œå¤–æ°´æ½¤äº®æ¾¤ã€‚", caloriesPerGram: 1.3, tags: ['coat', 'skin', 'general'], macros: { protein: 30, fat: 50, carbs: 20 }, recommendedSupplements: ['fd_fish'], imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#AED6F1"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#3498DB">ç¾æ¯›äº®æ¾¤é¤</text></svg>')}`, ingredients: [ { name: "é®­é­š", percentage: 0.40, note: "å¯Œå«Omega-3è„‚è‚ªé…¸(EPA/DHA)ï¼Œæœ‰åŠ©æ–¼æŠ—ç™¼ç‚ã€ç¶­æŒçš®è†šå±éšœå¥åº·ï¼Œä½¿æ¯›é«®äº®æ¾¤ã€‚", allergen_id: 'fish' }, { name: "é›è›‹ (å«è›‹é»ƒ)", percentage: 0.15, note: "è›‹é»ƒæ˜¯ç”Ÿç‰©ç´ å’Œåµç£·è„‚çš„çµ•ä½³ä¾†æºï¼Œå…©è€…éƒ½æ˜¯ç¶­æŒçš®è†šå¥åº·å’Œæ¯›é«®ç”Ÿé•·çš„é‡è¦ç‡Ÿé¤Šç´ ã€‚", allergen_id: 'egg' }, { name: "ç‡•éº¥", percentage: 0.20, note: "æä¾›ç¶­ç”Ÿç´ Bç¾¤å’Œç¤¦ç‰©è³ªé‹…ï¼Œæœ‰åŠ©æ–¼ç¶­æŒçš®è†šå¥åº·ï¼Œä¸¦æä¾›å„ªè³ªçº–ç¶­ã€‚", allergen_id: 'grain' }, { name: "åœ°ç“œ", percentage: 0.15, note: "å¯Œå«ç¶­ç”Ÿç´ Açš„å‰é©…ç‰©Î²-èƒ¡è˜¿è””ç´ ï¼Œç¶­ç”Ÿç´ Aå°æ–¼çš®è†šç´°èƒçš„æ­£å¸¸ç”Ÿé•·å’Œä¿®å¾©è‡³é—œé‡è¦ã€‚" }, { name: "è‘µèŠ±ç±½ (ç„¡é¹½)", percentage: 0.10, note: "ç¶­ç”Ÿç´ Eå’Œäºéº»æ²¹é…¸çš„è±å¯Œä¾†æºï¼Œç¶­ç”Ÿç´ Eæ˜¯é‡è¦çš„æŠ—æ°§åŒ–åŠ‘ï¼Œèƒ½ä¿è­·çš®è†šç´°èƒã€‚" } ] },
            skin_recipe: { id: 'skin_recipe', name: "ä½æ•è­·è†šé´¨è‚‰é¤", primaryTarget: "çš®è†šæ•æ„Ÿ / æ”ç™¢", description: "å°æŠ—æ”ç™¢ä¸é©çš„ã€æ»…ç«é…æ–¹ã€ï¼Œä»¥ä½æ•è›‹ç™½æ­é…æŠ—ç™¼ç‚é£Ÿæï¼Œå¾æ ¹æœ¬èª¿ç†çš®è†šå¥åº·ã€‚", caloriesPerGram: 1.25, tags: ['skin'], macros: { protein: 38, fat: 40, carbs: 22 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#D5F5E3"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#28B463">ä½æ•è­·è†šé¤</text></svg>')}`, ingredients: [ { name: "é´¨è‚‰", percentage: 0.50, note: "å±¬æ–¼è¼ƒä¸æ˜“å¼•èµ·éæ•åæ‡‰çš„æ–°ç©è›‹ç™½è³ªï¼Œé©åˆé£Ÿç‰©æ•æ„Ÿå°è‡´çš®è†šå•é¡Œçš„çŠ¬éš»ã€‚", allergen_id: 'duck' }, { name: "è—œéº¥", percentage: 0.20, note: "ç„¡éº©è³ªçš„å½ç©€ç‰©ï¼Œå¯Œå«å®Œæ•´çš„èƒºåŸºé…¸å’Œå¤šç¨®ç¤¦ç‰©è³ªï¼Œæ˜¯ä½æ•çš„èƒ½é‡ä¾†æºã€‚", allergen_id: 'grain' }, { name: "åœ°ç“œ", percentage: 0.15, note: "å¯Œå«æŠ—æ°§åŒ–ç‰©Î²-èƒ¡è˜¿è””ç´ ï¼Œæœ‰åŠ©æ–¼æ¸…é™¤é«”å…§è‡ªç”±åŸºï¼Œæ¸›è¼•ç™¼ç‚åæ‡‰ã€‚" }, { name: "è–‘é»ƒç²‰", percentage: 0.05, note: "å…¶æ´»æ€§æˆåˆ†è–‘é»ƒç´ æ˜¯å¼·æ•ˆçš„å¤©ç„¶æŠ—ç™¼ç‚åŠ‘ï¼Œæœ‰åŠ©æ–¼å¾é«”å…§èˆ’ç·©çš®è†šç™¼ç‚ã€‚" }, { name: "æ¤°å­æ²¹", percentage: 0.10, note: "å¯Œå«æœˆæ¡‚é…¸ï¼Œå…·æœ‰æŠ—èŒç‰¹æ€§ï¼ŒåŒæ™‚ä¸­éˆè„‚è‚ªé…¸æœ‰åŠ©æ–¼ç¶­æŒçš®è†šå¥åº·ã€‚" } ] },
            tear_stain_recipe: { id: 'tear_stain_recipe', name: "æ·šç—•æ¸…çˆ½é´¨è‚‰é¤", primaryTarget: "æ·šç—•å•é¡Œ", description: "å‘Šåˆ¥ã€å°èŠ±è‡‰ã€çš„é«”å…§èª¿ç†é¤ã€‚å¾ä½æ•ã€æŠ—ç‚ã€åˆ©æ¿•è‘—æ‰‹ï¼Œæ‰“é€ æ¸…çˆ½æ˜äº®çš„é›™çœ¸ã€‚", caloriesPerGram: 1.2, tags: ['tear_stain', 'skin', 'eye_health'], macros: { protein: 40, fat: 35, carbs: 25 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#FDEBD0"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#E67E22">æ·šç—•æ¸…çˆ½é¤</text></svg>')}`, ingredients: [ { name: "é´¨è‚‰", percentage: 0.50, note: "ä½¿ç”¨ä½è‡´æ•æ€§çš„æ–°ç©è›‹ç™½ï¼Œæœ‰åŠ©æ–¼æ¸›å°‘å› é£Ÿç‰©ä¸è€å¼•èµ·çš„å…¨èº«æ€§ç™¼ç‚ï¼Œé€²è€Œæ”¹å–„æ·šæ¶²éåº¦åˆ†æ³Œã€‚", allergen_id: 'duck' }, { name: "è–ä»", percentage: 0.20, note: "åœ¨ä¸­é†«é£Ÿç™‚ä¸­æœ‰åˆ©æ°´æ»²æ¿•ã€å¥è„¾çš„åŠŸç”¨ï¼Œæœ‰åŠ©æ–¼æ”¹å–„é«”å…§æ¿•æ°£éé‡å¯èƒ½å°è‡´çš„çœ¼éƒ¨åˆ†æ³Œç‰©å•é¡Œã€‚", allergen_id: 'grain' }, { name: "è—è“", percentage: 0.10, note: "å¯Œå«èŠ±é’ç´ ï¼Œæ˜¯å¼·æ•ˆæŠ—æ°§åŒ–åŠ‘ï¼Œæœ‰åŠ©æ–¼ä¿è­·çœ¼éƒ¨å¾®è¡€ç®¡å¥åº·ï¼Œç¶­æŒçœ¼éƒ¨å¾ªç’°ã€‚" }, { name: "æ¸æ", percentage: 0.05, note: "å¯Œå«è‘‰é»ƒç´ ã€ç‰ç±³é»ƒç´ å’Œå¤šé†£é«”ï¼Œæ˜¯å‚³çµ±çš„è­·çœ¼é£Ÿæï¼Œæœ‰åŠ©æ–¼ä¿è­·è¦–ç¶²è†œã€‚" }, { name: "ç¯€ç“œ", percentage: 0.15, note: "é«˜å«æ°´ã€ä½ç†±é‡ï¼Œæœ‰åŠ©æ–¼è£œå……æ°´åˆ†ï¼ŒåŒæ™‚å…¶çº–ç¶­æœ‰åŠ©æ–¼ç¶­æŒè…¸é“å¥åº·ï¼Œæ¸›å°‘æ¯’ç´ ç´¯ç©ã€‚" } ] },
            eye_health_recipe: { id: 'eye_health_recipe', name: "æ˜çœ¸äº®çœ¼é®­é­šé¤", primaryTarget: "çœ¼ç›ä¿å¥", description: "å°ˆç‚ºå®ˆè­·éˆé­‚ä¹‹çª—è¨­è¨ˆï¼Œå¯Œå«è‘‰é»ƒç´ ã€ç‰ç±³é»ƒç´ èˆ‡Omega-3ï¼Œå¾å…§è€Œå¤–æ»‹é¤Šçœ¼éƒ¨å¥åº·ã€‚", caloriesPerGram: 1.25, tags: ['eye_health', 'senior'], macros: { protein: 35, fat: 45, carbs: 20 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#85C1E9"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">æ˜çœ¸äº®çœ¼é¤</text></svg>')}`, ingredients: [ { name: "é®­é­š", percentage: 0.40, note: "Omega-3è„‚è‚ªé…¸ä¸­çš„DHAæ˜¯æ§‹æˆè¦–ç¶²è†œæ„Ÿå…‰ç´°èƒçš„é‡è¦æˆåˆ†ï¼Œå°ç¶­æŒè¦–åŠ›æ¸…æ™°è‡³é—œé‡è¦ã€‚", allergen_id: 'fish' }, { name: "é›è›‹ (å«è›‹é»ƒ)", percentage: 0.15, note: "è›‹é»ƒæ˜¯è‘‰é»ƒç´ å’Œç‰ç±³é»ƒç´ çš„æ¥µä½³ç”Ÿç‰©åˆ©ç”¨ä¾†æºï¼Œé€™å…©ç¨®ç‡Ÿé¤Šç´ èƒ½éæ¿¾è—å…‰ã€ä¿è­·è¦–ç¶²è†œé»ƒæ–‘éƒ¨ã€‚", allergen_id: 'egg' }, { name: "èƒ¡è˜¿è””", percentage: 0.15, note: "æä¾›è±å¯Œçš„Î²-èƒ¡è˜¿è””ç´ ï¼Œå¯åœ¨é«”å…§è½‰åŒ–ç‚ºç¶­ç”Ÿç´ Aï¼Œç¶­ç”Ÿç´ Aæ˜¯ç¶­æŒæ­£å¸¸è¦–åŠ›(ç‰¹åˆ¥æ˜¯å¤œè¦–)çš„å¿…éœ€å“ã€‚" }, { name: "å—ç“œ", percentage: 0.15, note: "åŒæ¨£å¯Œå«Î²-èƒ¡è˜¿è””ç´ ã€è‘‰é»ƒç´ å’Œç‰ç±³é»ƒç´ ï¼Œç‚ºçœ¼ç›æä¾›å¤šé‡æŠ—æ°§åŒ–ä¿è­·ã€‚" }, { name: "æ¸æ", percentage: 0.05, note: "å¯Œå«æ¸æå¤šé†£èˆ‡ç‰ç±³é»ƒç´ ï¼Œå‚³çµ±ä¸Šç”¨æ–¼æ»‹è£œè‚è…ã€æ˜ç›®ï¼Œæœ‰åŠ©æ–¼å°æŠ—çœ¼ç›çš„æ°§åŒ–å£“åŠ›ã€‚" }, { name: "è—è“", percentage: 0.10, note: "èŠ±é’ç´ å«é‡æ¥µé«˜ï¼Œæœ‰åŠ©æ–¼ä¿ƒé€²çœ¼éƒ¨è¡€æ¶²å¾ªç’°ï¼Œå¢å¼·å¾®è¡€ç®¡éŸŒæ€§ï¼Œç·©è§£çœ¼ç›ç–²å‹ã€‚" } ] },
            venison_recipe: { id: 'venison_recipe', name: "é ‚ç´šä½æ•é¹¿è‚‰é¤", primaryTarget: "æ¥µåº¦æ•æ„Ÿè‚Œè†š/è…¸èƒƒ", description: "æ¡ç”¨æ¥µä½æ•çš„é¹¿è‚‰ä½œç‚ºå–®ä¸€æ–°ç©è›‹ç™½ï¼Œå°ˆç‚ºéœ€è¦é¿é–‹å¸¸è¦‹éæ•åŸçš„ç‹—ç‹—è¨­è¨ˆã€‚", caloriesPerGram: 1.3, tags: ['skin', 'gi_health', 'general'], macros: { protein: 40, fat: 38, carbs: 22 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#A93226"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">é ‚ç´šé¹¿è‚‰é¤</text></svg>')}`, ingredients: [ { name: "é¹¿è‚‰", percentage: 0.55, note: "æ¥µå°‘è¦‹çš„å‹•ç‰©è›‹ç™½ä¾†æºï¼Œå¯ä½œç‚ºé£Ÿç‰©æ’é™¤è©¦é©—çš„ç†æƒ³é¸æ“‡ï¼Œå¤§å¹…é™ä½é£Ÿç‰©éæ•æˆ–ä¸è€çš„é¢¨éšªã€‚", allergen_id: 'venison' }, { name: "å—ç“œ", percentage: 0.20, note: "æº«å’Œçš„çº–ç¶­ä¾†æºï¼Œæœ‰åŠ©æ–¼ç©©å®šè…¸é“åŠŸèƒ½ï¼Œå…¶Î²-èƒ¡è˜¿è””ç´ äº¦æœ‰åŠ©æ–¼çš®è†šå¥åº·ã€‚" }, { name: "è èœ", percentage: 0.10, note: "æä¾›è±å¯Œçš„éµè³ªã€ç¶­ç”Ÿç´ Kå’Œè‘‰é…¸ï¼Œæœ‰åŠ©æ–¼ç¶­æŒæ•´é«”å¥åº·ï¼Œä½†è…è‡Ÿå•é¡ŒçŠ¬éš»éœ€æ³¨æ„ä»½é‡ã€‚" }, { name: "è—è“", percentage: 0.10, note: "å¼·æ•ˆçš„æŠ—æ°§åŒ–åŠ‘ä¾†æºï¼Œæœ‰åŠ©æ–¼ä¸­å’Œé«”å…§è‡ªç”±åŸºï¼Œé™ä½å› éæ•å¼•èµ·çš„ç™¼ç‚åæ‡‰ã€‚" }, { name: "å¥‡äºç±½", percentage: 0.05, note: "æä¾›æ¤ç‰©æ€§Omega-3 (ALA)èˆ‡æ°´æº¶æ€§çº–ç¶­ï¼Œæœ‰åŠ©æ–¼æ»‹æ½¤çš®è†šä¸¦ä¿ƒé€²è…¸é“å¥åº·ã€‚" } ] },
            lamb_oat_recipe: { id: 'lamb_oat_recipe', name: "èˆ’æ•è­·è†šç¾Šè‚‰ç‡•éº¥ç²¥", primaryTarget: "çš®è†šæ•æ„Ÿ / è…¸èƒƒæº«å’Œ", description: "æ¡ç”¨æº«æ€§çš„ç¾Šè‚‰ä½œç‚ºä½æ•è›‹ç™½ï¼Œæ­é…ç‡•éº¥èˆ‡äºéº»ç±½æ²¹ï¼Œæº«å’Œèª¿ç†æ•æ„Ÿçš„çš®è†šèˆ‡è…¸èƒƒã€‚", caloriesPerGram: 1.25, tags: ['skin', 'gi_health'], macros: { protein: 35, fat: 40, carbs: 25 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#EAEAEA"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#555">èˆ’æ•ç¾Šè‚‰é¤</text></svg>')}`, ingredients: [ { name: "ç¾Šè‚‰", percentage: 0.50, note: "ä¸€ç¨®æº«æ€§ä¸”è¼ƒä¸æ˜“è‡´æ•çš„æ–°ç©è›‹ç™½è³ªï¼Œå¯Œå«è‚‰é¹¼èˆ‡é‹…ï¼Œæœ‰åŠ©æ–¼èƒ½é‡ä»£è¬èˆ‡çš®è†šä¿®å¾©ã€‚", allergen_id: 'lamb' }, { name: "ç‡•éº¥", percentage: 0.20, note: "å¯Œå«æ°´æº¶æ€§çº–ç¶­Î²-è‘¡èšé†£ï¼Œæœ‰åŠ©æ–¼ç©©å®šè¡€ç³–ï¼Œå…¶å¤©ç„¶æˆåˆ†èƒ½èˆ’ç·©çš®è†šä¸é©ã€‚", allergen_id: 'grain' }, { name: "å—ç“œ", percentage: 0.15, note: "æä¾›å¯æº¶æ€§èˆ‡ä¸å¯æº¶æ€§çº–ç¶­ï¼Œå¹«åŠ©èª¿ç¯€è…¸é“èŒå¢ç”Ÿæ…‹ï¼Œç©©å®šç³ä¾¿ç‹€æ…‹ã€‚" }, { name: "è èœ", percentage: 0.10, note: "å¯Œå«éµã€è‘‰é…¸èˆ‡ç¶­ç”Ÿç´ Kï¼Œæ˜¯ç‡Ÿé¤Šå¯†é›†çš„ç¶ è‰²è”¬èœï¼Œæœ‰åŠ©æ–¼æ•´é«”å¥åº·ã€‚" }, { name: "äºéº»ç±½æ²¹", percentage: 0.05, note: "æ¤ç‰©æ€§Omega-3 (ALA) çš„å„ªè³ªä¾†æºï¼Œç¶“é«”å…§è½‰åŒ–æœ‰åŠ©æ–¼æŠ—ç™¼ç‚ï¼Œæ”¹å–„çš®è†šç‹€æ³ã€‚" } ] },
            beef_power_recipe: { id: 'beef_power_recipe', name: "é«˜èƒ½é‡æ´»åŠ›ç‰›è‚‰é¤", primaryTarget: "é«˜æ´»å‹•é‡ / å¢è‚Œéœ€æ±‚", description: "ç‚ºå¥½å‹•çš„ç‹—ç‹—è¨­è¨ˆçš„èƒ½é‡æ¨é€²å™¨ï¼Œæä¾›é«˜ç”Ÿç‰©åƒ¹å€¼çš„è›‹ç™½è³ªèˆ‡è¤‡åˆç¢³æ°´ï¼Œæ”¯æŒè‚Œè‚‰ç™¼å±•èˆ‡é«”åŠ›æ¢å¾©ã€‚", caloriesPerGram: 1.35, tags: ['performance', 'puppy'], macros: { protein: 40, fat: 35, carbs: 25 }, imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#C0392B"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">é«˜èƒ½ç‰›è‚‰é¤</text></svg>')}`, ingredients: [ { name: "ç‰›è‚‰ (ç˜¦)", percentage: 0.45, note: "å¯Œå«è‚Œé…¸ã€éµå’Œé‹…ï¼Œæ˜¯å»ºæ§‹å¼·å£¯è‚Œè‚‰ã€æå‡é‹å‹•è¡¨ç¾å’Œè€åŠ›çš„é—œéµè›‹ç™½è³ªä¾†æºã€‚", allergen_id: 'beef' }, { name: "ç‰›å¿ƒ", percentage: 0.10, note: "å¤©ç„¶çš„ç‰›ç£ºé…¸èˆ‡è¼”é…¶Q10å¯¶åº«ï¼Œå°æ–¼å¿ƒè‚ŒåŠŸèƒ½å’Œèƒ½é‡è½‰æ›è‡³é—œé‡è¦ã€‚", allergen_id: 'beef' }, { name: "åœ°ç“œ", percentage: 0.20, note: "æä¾›ç·©æ…¢é‡‹æ”¾èƒ½é‡çš„è¤‡åˆç¢³æ°´åŒ–åˆç‰©ï¼Œç‚ºé•·æ™‚é–“çš„æ´»å‹•æä¾›ç©©å®šçºŒèˆªåŠ›ã€‚" }, { name: "è—œéº¥", percentage: 0.15, note: "æä¾›å®Œæ•´æ¤ç‰©æ€§èƒºåŸºé…¸çš„ç„¡éº©è³ªç©€ç‰©ï¼Œæœ‰åŠ©æ–¼è‚Œè‚‰çš„ä¿®å¾©èˆ‡ç”Ÿé•·ã€‚", allergen_id: 'grain' }, { name: "é’èŠ±èœ", percentage: 0.10, note: "å¯Œå«ç¶­ç”Ÿç´ Cå’ŒKï¼Œä»¥åŠæŠ—æ°§åŒ–ç‰©è˜¿è””ç¡«ç´ ï¼Œæœ‰åŠ©æ–¼æ”¯æŒéª¨éª¼å¥åº·èˆ‡å°æŠ—é‹å‹•å¾Œçš„æ°§åŒ–å£“åŠ›ã€‚" } ] },
            plant_based_recipe: { id: 'plant_based_recipe', name: "è”¬é£Ÿæ´»åŠ›é·¹å˜´è±†é¤", primaryTarget: "è›‹ç™½è³ªè¼ªæ›¿ / ç‰¹æ®Šé£²é£Ÿéœ€æ±‚", description: "ä¸€æ¬¾ç²¾å¿ƒè¨­è¨ˆçš„æ¤ç‰©æ€§é£²é£Ÿé¸æ“‡ï¼Œé©åˆéœ€è¦æš«æ™‚é¿é–‹æ‰€æœ‰å‹•ç‰©è›‹ç™½çš„ç‰¹æ®Šæƒ…æ³ã€‚", caloriesPerGram: 1.1, tags: ['general'], macros: { protein: 25, fat: 30, carbs: 45 }, specialNote: "æ³¨æ„ï¼šæ­¤ç‚ºå°ˆæ¥­é€²éšé£Ÿè­œï¼Œä¸å»ºè­°é•·æœŸä½œç‚ºå”¯ä¸€ä¸»é£Ÿï¼Œé™¤éåœ¨ç¸é†«æˆ–å¯µç‰©ç‡Ÿé¤Šå¸«çš„åš´æ ¼ç›£ç£èˆ‡æŒ‡å°ä¸‹ï¼Œä¸¦æ­é…ç‰¹å®šçš„èƒºåŸºé…¸èˆ‡ç¶­ç”Ÿç´ è£œå……å“(å¦‚L-è‚‰é¹¼ã€ç‰›ç£ºé…¸ã€B12)ã€‚", imageUrl: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 60"><rect width="120" height="60" fill="#2ECC71"/><text x="60" y="35" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">è”¬é£Ÿæ´»åŠ›é¤</text></svg>')}`, ingredients: [ { name: "é·¹å˜´è±†", percentage: 0.25, note: "å„ªè³ªçš„æ¤ç‰©è›‹ç™½èˆ‡çº–ç¶­ä¾†æºï¼Œæä¾›é£½è¶³æ„Ÿèˆ‡ç©©å®šèƒ½é‡ã€‚" }, { name: "æ¿è±†è… (éåŸºå› æ”¹é€ )", percentage: 0.25, note: "æ˜“æ–¼æ¶ˆåŒ–çš„æ¤ç‰©è›‹ç™½ï¼Œè³ªåœ°æŸ”è»Ÿï¼Œæ˜¯å»ºæ§‹èº«é«”çµ„ç¹”çš„åŸºç¤ã€‚" }, { name: "æ‰è±†", percentage: 0.15, note: "å¯Œå«è›‹ç™½è³ªã€éµè³ªèˆ‡è‘‰é…¸ï¼Œæ˜¯ç‡Ÿé¤Šå¯†åº¦éå¸¸é«˜çš„è±†é¡ã€‚" }, { name: "è—œéº¥", percentage: 0.15, note: "å°‘æ•¸æä¾›æ‰€æœ‰å¿…éœ€èƒºåŸºé…¸çš„æ¤ç‰©ï¼Œæ˜¯ç¢ºä¿è›‹ç™½è³ªå®Œæ•´çš„é—œéµã€‚", allergen_id: 'grain' }, { name: "ç‡Ÿé¤Šé…µæ¯", percentage: 0.05, note: "æä¾›å¤©ç„¶çš„ç¶­ç”Ÿç´ Bç¾¤èˆ‡é¡ä¼¼èµ·å¸çš„é®®å‘³ï¼Œèƒ½å¤§å¹…æå‡é©å£æ€§ã€‚" }, { name: "èƒ¡è˜¿è””", percentage: 0.10, note: "æä¾›Î²-èƒ¡è˜¿è””ç´ ï¼Œä½œç‚ºæŠ—æ°§åŒ–åŠ‘ä¸¦åœ¨é«”å…§è½‰åŒ–ç‚ºç¶­ç”Ÿç´ Aã€‚" }, { name: "è èœ", percentage: 0.05, note: "æä¾›éµè³ªèˆ‡å¤šç¨®ç¶­ç”Ÿç´ ï¼Œå¢åŠ é£Ÿè­œçš„ç‡Ÿé¤Šå¤šæ¨£æ€§ã€‚" } ] }
        };
        const snackData = {
            'dental_stick_s': { name: 'æ½”ç‰™éª¨ (å°)', calories: 50, unit: 'æ ¹' },
            'dental_stick_m': { name: 'æ½”ç‰™éª¨ (ä¸­)', calories: 90, unit: 'æ ¹' },
            'jerky_chicken': { name: 'é›è‚‰ä¹¾', calories: 3.5, unit: 'å…‹' },
            'jerky_beef': { name: 'ç‰›è‚‰ä¹¾', calories: 4.0, unit: 'å…‹' },
            'biscuit_s': { name: 'å°é¥…é ­/é¤…ä¹¾', calories: 5, unit: 'é¡†' },
            'freeze_dried_liver': { name: 'å‡ä¹¾é›è‚', calories: 5.5, unit: 'å…‹' }
        };
        // --- UPDATED: Added 'rabbit' to the allergen list ---
        const ALLERGENS = { chicken: 'é›è‚‰', duck: 'é´¨è‚‰', turkey: 'ç«é›è‚‰', beef: 'ç‰›è‚‰', venison: 'é¹¿è‚‰', lamb: 'ç¾Šè‚‰', rabbit: 'å…”è‚‰', fish: 'é­šè‚‰', egg: 'é›è›‹', grain: 'ç©€ç‰©' };
        
        const myProducts = {
            'fd_chicken': { id: 'fd_chicken', name: 'é ‚ç´šå‡ä¹¾é›è‚‰é¬†', description: '100%ç´”å¤©ç„¶é›èƒ¸è‚‰è£½æˆï¼Œè£œå……å„ªè³ªè›‹ç™½çš„æœ€ä½³é¸æ“‡ã€‚', price: 280, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#FAD7A0"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="#D35400">é›è‚‰é¬†</text></svg>')}` },
            'fd_duck': { id: 'fd_duck', name: 'ä½æ•å‡ä¹¾é´¨è‚‰å¡Š', description: 'åš´é¸æ«»æ¡ƒé´¨ï¼Œæ–°ç©è›‹ç™½ä¾†æºï¼Œé©åˆæ˜“æ•é«”è³ªã€‚', price: 320, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#F5B041"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="#A0522D">é´¨è‚‰å¡Š</text></svg>')}` },
            'fd_venison': { id: 'fd_venison', name: 'ç´è¥¿è˜­å‡ä¹¾é¹¿è‚‰ç‰‡', description: 'æ¥µè‡´ä½æ•ï¼Œä¾†è‡ªç´”æ·¨ç´è¥¿è˜­çš„è‰é£¼é¹¿ï¼Œç‡Ÿé¤Šè±å¯Œã€‚', price: 450, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#C0392B"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="white">é¹¿è‚‰ç‰‡</text></svg>')}` },
            'fd_fish': { id: 'fd_fish', name: 'å†°å³¶é±ˆé­šå‡ä¹¾ä¸', description: 'å¯Œå«Omega-3ï¼Œå¹«åŠ©çš®è†šäº®æ¯›ï¼Œæ˜¯ç‹—ç‹—çš„æœ€æ„›ã€‚', price: 350, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#5DADE2"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="white">é±ˆé­šä¸</text></svg>')}` },
            'fd_lamb': { id: 'fd_lamb', name: 'æ¾³æ´²å‡ä¹¾ç¾Šè‚‰å¡Š', description: 'æº«æ€§ä½æ•ç¾Šè‚‰ï¼Œé©åˆè…¸èƒƒåŠçš®è†šæ•æ„Ÿçš„ç‹—ç‹—ã€‚', price: 380, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#EAEAEA"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="#555">ç¾Šè‚‰å¡Š</text></svg>')}` },
            'fd_beef': { id: 'fd_beef', name: 'è‰é£¼ç‰›å‡ä¹¾è‚‰ç‰‡', description: 'é«˜èƒ½é‡é«˜è›‹ç™½ï¼Œæ˜¯å¥½å‹•ç‹—ç‹—çš„æœ€ä½³é«”åŠ›è£œå……ã€‚', price: 360, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#E74C3C"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="white">ç‰›è‚‰ç‰‡</text></svg>')}` },
            'sup_gl': { id: 'sup_gl', name: 'pp pawfact é—œç¯€ç´ ', description: 'é«˜ç´”åº¦ç¶ å”‡è²ç²‰ï¼Œç¶­æŒé—œç¯€éˆæ´»ï¼Œæ­¥æ­¥ç©©å¥ã€‚', price: 550, image_url: `data:image/svg+xml,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" fill="#2ECC71"/><text x="50" y="55" font-family="Arial" font-size="12" text-anchor="middle" fill="white">é—œç¯€ç´ </text></svg>')}` }
        };

        // --- DOM Element References ---
        const formElements = {
            healthIssue: document.getElementById('health-issue'), recipeChoice: document.getElementById('recipe-choice'), allergenFilter: document.getElementById('allergen-filter'), recipeWarning: document.getElementById('recipe-warning'), dogName: document.getElementById('dog-name'), dogAge: document.getElementById('dog-age'), dogWeight: document.getElementById('dog-weight'), activityLevel: document.getElementById('activity-level'), neutered: (val) => document.querySelector(`input[name="neutered"][value="${val}"]`), mealsPerDay: document.getElementById('meals-per-day'), form: document.getElementById('dog-form')
        };
        const profileManager = document.getElementById('profile-manager');
        const profileElements = {
            select: document.getElementById('profile-select'), saveBtn: document.getElementById('save-profile-btn'), message: document.getElementById('profile-message')
        };
        const snackElements = {
            select: document.getElementById('snack-select'), quantity: document.getElementById('snack-quantity'), unit: document.getElementById('snack-unit'), calculateBtn: document.getElementById('calculate-snack-btn'), result: document.getElementById('snack-result')
        };
        const rotationList = document.getElementById('rotation-list');
        const sourcesToggleBtn = document.getElementById('toggle-sources-btn');
        const sourcesContent = document.getElementById('sources-content');
        
        const shoppingListIcon = document.getElementById('shopping-list-icon');
        const shoppingListBadge = document.getElementById('shopping-list-badge');
        const shoppingListModal = document.getElementById('shopping-list-modal');
        const listModalCloseBtn = document.getElementById('list-modal-close-btn');
        const listModalBody = document.getElementById('list-modal-body');
        const listTotalPrice = document.getElementById('list-total-price');
        const checkoutBtn = document.getElementById('checkout-btn');
        const emptyListMsg = document.getElementById('empty-list-msg');
        const emailCaptureForm = document.getElementById('email-capture-form');

        let currentDER = 0;
        let storageAvailable = false;
        let shoppingList = [];

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            storageAvailable = isLocalStorageAvailable();
            if (storageAvailable) {
                loadProfiles();
                profileElements.saveBtn.addEventListener('click', saveProfile);
                profileElements.select.addEventListener('change', loadSelectedProfile);
            } else {
                profileManager.style.display = 'none';
                console.warn('localStorage is not available. Dog profile feature is disabled.');
            }
            for (const key in ALLERGENS) {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox'; checkbox.name = 'allergen'; checkbox.value = key;
                checkbox.addEventListener('change', updateRecipeOptions);
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(` ${ALLERGENS[key]}`));
                formElements.allergenFilter.appendChild(label);
            }
            for (const key in snackData) {
                const option = document.createElement('option');
                option.value = key; option.textContent = snackData[key].name;
                snackElements.select.appendChild(option);
            }
            
            formElements.healthIssue.addEventListener('change', updateRecipeOptions);
            formElements.form.addEventListener('submit', handleFormSubmit);
            document.getElementById('calculate-batch-btn').addEventListener('click', calculateBatch);
            
            snackElements.select.addEventListener('change', updateSnackUnit);
            snackElements.calculateBtn.addEventListener('click', calculateSnacks);
            sourcesToggleBtn.addEventListener('click', () => sourcesContent.classList.toggle('show'));
            
            shoppingListIcon.addEventListener('click', () => shoppingListModal.classList.add('show'));
            listModalCloseBtn.addEventListener('click', () => shoppingListModal.classList.remove('show'));
            shoppingListModal.addEventListener('click', (e) => { if (e.target === shoppingListModal) shoppingListModal.classList.remove('show'); });
            checkoutBtn.addEventListener('click', handleCheckout);
            listModalBody.addEventListener('click', handleListAction);
            emailCaptureForm.addEventListener('submit', handleEmailSubmit);

            updateSnackUnit();
        });

        // --- FEATURE DETECTION ---
        function isLocalStorageAvailable() {
            try {
                const test = '__storage_test__';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                return false;
            }
        }

        // --- PROFILE MANAGEMENT ---
        function saveProfile() {
            if (!storageAvailable) return;
            const dogName = formElements.dogName.value.trim();
            if (!dogName) { alert('è«‹å…ˆè¼¸å…¥ç‹—ç‹—çš„åå­—å†å„²å­˜ï¼'); return; }
            const profileData = { name: dogName, age: formElements.dogAge.value, weight: formElements.dogWeight.value, activity: formElements.activityLevel.value, neutered: document.querySelector('input[name="neutered"]:checked').value, meals: formElements.mealsPerDay.value };
            let profiles = JSON.parse(localStorage.getItem('dogProfiles')) || {};
            profiles[dogName] = profileData;
            localStorage.setItem('dogProfiles', JSON.stringify(profiles));
            profileElements.message.textContent = `å·²å„²å­˜/æ›´æ–° ${dogName} çš„æª”æ¡ˆï¼`;
            setTimeout(() => { profileElements.message.textContent = ''; }, 3000);
            loadProfiles();
            profileElements.select.value = dogName;
        }

        function loadProfiles() {
            if (!storageAvailable) return;
            let profiles = JSON.parse(localStorage.getItem('dogProfiles')) || {};
            profileElements.select.innerHTML = '<option value="">-- è¼‰å…¥å·²å­˜æª”çš„ç‹—ç‹— --</option>';
            for (const name in profiles) {
                const option = document.createElement('option');
                option.value = name; option.textContent = name;
                profileElements.select.appendChild(option);
            }
        }

        function loadSelectedProfile() {
            if (!storageAvailable) return;
            const selectedName = profileElements.select.value;
            if (!selectedName) return;
            let profiles = JSON.parse(localStorage.getItem('dogProfiles')) || {};
            const profile = profiles[selectedName];
            if (profile) {
                formElements.dogName.value = profile.name; formElements.dogAge.value = profile.age; formElements.dogWeight.value = profile.weight; formElements.activityLevel.value = profile.activity; formElements.neutered(profile.neutered).checked = true; formElements.mealsPerDay.value = profile.meals;
                profileElements.message.textContent = `å·²è¼‰å…¥ ${profile.name} çš„æª”æ¡ˆã€‚`;
                setTimeout(() => { profileElements.message.textContent = ''; }, 3000);
            }
        }

        // --- DYNAMIC FORM LOGIC ---
        function updateRecipeOptions() {
            const selectedTag = formElements.healthIssue.value;
            const selectedAllergens = Array.from(formElements.allergenFilter.querySelectorAll('input:checked')).map(cb => cb.value);
            formElements.recipeChoice.innerHTML = '<option value="" disabled selected>-- è«‹é¸æ“‡æ¨è–¦çš„é£Ÿè­œ --</option>';
            formElements.recipeWarning.textContent = '';
            if (!selectedTag) { formElements.recipeChoice.disabled = true; return; }
            let availableRecipes = 0;
            for (const recipeId in recipes) {
                const recipe = recipes[recipeId];
                const hasTag = recipe.tags.includes(selectedTag);
                const hasAllergen = recipe.ingredients.some(ingredient => ingredient.allergen_id && selectedAllergens.includes(ingredient.allergen_id));
                if (hasTag && !hasAllergen) {
                    const option = document.createElement('option');
                    option.value = recipeId; option.textContent = recipe.name;
                    formElements.recipeChoice.appendChild(option);
                    availableRecipes++;
                }
            }
            if (availableRecipes === 0) {
                formElements.recipeChoice.innerHTML = '<option value="" disabled selected>-- ç„¡ç¬¦åˆæ¢ä»¶çš„é£Ÿè­œ --</option>';
                formElements.recipeWarning.textContent = 'âš ï¸ æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„é£Ÿè­œï¼Œè«‹å˜—è©¦æ¸›å°‘å‹¾é¸çš„éæ•åŸã€‚';
            }
            formElements.recipeChoice.disabled = false;
        }

        // --- MAIN CALCULATION LOGIC ---
        function handleFormSubmit(event) {
            if(event) event.preventDefault();
            const formData = {
                recipeId: formElements.recipeChoice.value, dogName: formElements.dogName.value, dogWeight: parseFloat(formElements.dogWeight.value), activityLevel: parseFloat(formElements.activityLevel.value), mealsPerDay: parseInt(formElements.mealsPerDay.value)
            };
            if (!formData.recipeId) { alert('è«‹å…ˆé¸æ“‡ä¸€ä»½é£Ÿè­œã€‚å¦‚æœåˆ—è¡¨ç‚ºç©ºï¼Œè«‹èª¿æ•´æ‚¨çš„å¥åº·ç›®æ¨™æˆ–éæ•åŸé¸é …ã€‚'); return; }
            if (!formData.dogName || isNaN(formData.dogWeight) || formData.dogWeight <= 0) { alert('è«‹å®Œæ•´å¡«å¯«ç‹—ç‹—çš„è³‡è¨Šï¼Œä¸¦ç¢ºä¿é«”é‡å’Œå¹´é½¡ç‚ºæœ‰æ•ˆæ•¸å­—ã€‚'); return; }
            const selectedRecipe = recipes[formData.recipeId];
            const RER = 70 * Math.pow(formData.dogWeight, 0.75);
            const derMultiplier = formData.activityLevel;
            currentDER = RER * derMultiplier;
            const dailyFoodWeight = currentDER / selectedRecipe.caloriesPerGram;
            updateResultsUI(currentDER, dailyFoodWeight, formData, selectedRecipe);
            document.getElementById('result-section').style.display = 'block';
            if(event) {
                document.getElementById('result-section').scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // --- UI UPDATE & NEW FEATURE FUNCTIONS ---
        function updateResultsUI(DER, dailyFoodWeight, formData, recipe) {
            const recipeImage = document.getElementById('recipe-image');
            recipeImage.src = recipe.imageUrl;
            recipeImage.alt = recipe.name;

            document.getElementById('recipe-title').textContent = `ç‚º ${formData.dogName} è¨­è¨ˆçš„ã€${recipe.name}ã€`;
            document.getElementById('recipe-target-issue').innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 24 24" width="16px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg> <strong>ä¸»è¦é‡å°ï¼š</strong>${recipe.primaryTarget}`;
            document.getElementById('recipe-subtitle').textContent = recipe.description;

            const specialNoteEl = document.getElementById('recipe-special-note');
            if (recipe.specialNote) {
                specialNoteEl.innerHTML = recipe.specialNote; // Use innerHTML to render any HTML tags
                specialNoteEl.style.display = 'block';
            } else {
                specialNoteEl.style.display = 'none';
            }
            
            document.getElementById('daily-calories').textContent = `${Math.round(DER)} kcal`;
            document.getElementById('daily-food-weight').textContent = `${Math.round(dailyFoodWeight)} g`;
            document.getElementById('meal-portion').textContent = `${Math.round(dailyFoodWeight / formData.mealsPerDay)} g`;
            
            const macros = recipe.macros;
            const proteinPct = macros.protein;
            const fatPct = macros.fat;
            const carbPct = macros.carbs;
            const pieChart = document.getElementById('macro-pie-chart');
            const legend = document.getElementById('macro-pie-legend');
            
            pieChart.style.background = `conic-gradient(
                var(--protein-color) 0% ${proteinPct}%, 
                var(--fat-color) ${proteinPct}% ${proteinPct + fatPct}%, 
                var(--carb-color) ${proteinPct + fatPct}% 100%
            )`;
            
            legend.innerHTML = `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--protein-color);"></div>
                    <div class="legend-label">è›‹ç™½è³ª</div>
                    <div class="legend-value">
                        ${proteinPct}%<br>
                        <span class="legend-grams">â‰ˆ ${((DER * proteinPct / 100) / 4).toFixed(1)} g</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--fat-color);"></div>
                    <div class="legend-label">è„‚è‚ª</div>
                    <div class="legend-value">
                        ${fatPct}%<br>
                        <span class="legend-grams">â‰ˆ ${((DER * fatPct / 100) / 9).toFixed(1)} g</span>
                    </div>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--carb-color);"></div>
                    <div class="legend-label">ç¢³æ°´åŒ–åˆç‰©</div>
                    <div class="legend-value">
                        ${carbPct}%<br>
                        <span class="legend-grams">â‰ˆ ${((DER * carbPct / 100) / 4).toFixed(1)} g</span>
                    </div>
                </div>
            `;

            const ingredientsTbody = document.querySelector('#ingredients-table tbody');
            ingredientsTbody.innerHTML = '';
            recipe.ingredients.forEach(ing => {
                const weight = dailyFoodWeight * ing.percentage;
                ingredientsTbody.innerHTML += `<tr><td data-label="é£Ÿæ">${ing.name}</td><td data-label="ä»½é‡">${weight.toFixed(1)} g</td><td data-label="åŠŸæ•ˆ">${ing.note}</td></tr>`;
            });
            
            document.getElementById('purchase-dog-name').textContent = formData.dogName;
            populatePurchaseSuggestion(recipe);
            populateComboRecommendation(recipe);
            
            updateSupplementsTable(DER, formData.dogWeight, recipe);
            document.getElementById('batch-result').innerHTML = '';
            snackElements.result.innerHTML = '';
            populateRotationSuggestions(recipe.id);
        }

        // --- Purchase Suggestion & Shopping List Logic ---
        function createPurchaseCard(product, recommendedQty = 1) {
            return `
                <div class="purchase-card" data-product-id="${product.id}">
                    <img src="${product.image_url}" alt="${product.name}" class="purchase-image">
                    <div class="purchase-details">
                        <h4>${product.name}</h4>
                        <p class="desc">${product.description}</p>
                        <div class="purchase-controls">
                            <div class="quantity-selector">
                                <button class="quantity-btn" data-action="minus">-</button>
                                <span class="quantity">${recommendedQty}</span>
                                <button class="quantity-btn" data-action="plus">+</button>
                            </div>
                            <span>åŒ…ï¼Œç¸½è¨ˆ:</span>
                            <span class="total-price">NT$ ${recommendedQty * product.price}</span>
                            <button class="add-to-list-btn">åŠ å…¥æ¡è³¼æ¸…å–®</button>
                        </div>
                    </div>
                </div>`;
        }

        function populatePurchaseSuggestion(recipe) {
            const container = document.getElementById('purchase-suggestion-content');
            const mainProteinIngredient = recipe.ingredients.find(ing => ing.allergen_id && (myProducts[`fd_${ing.allergen_id}`]));
            if (!mainProteinIngredient) { container.innerHTML = '<p>é€™ä»½é£Ÿè­œæ²’æœ‰æ˜ç¢ºçš„å–®ä¸€è‚‰é¡è›‹ç™½ï¼Œæš«ç„¡ç‰¹åˆ¥æ¨è–¦çš„é›¶é£Ÿã€‚</p>'; return; }
            
            const recommendedProductId = `fd_${mainProteinIngredient.allergen_id}`;
            const recommendedProduct = myProducts[recommendedProductId];
            if (!recommendedProduct) { container.innerHTML = '<p>ç›®å‰æ²’æœ‰å¯æ¨è–¦çš„é›¶é£Ÿç”¢å“ã€‚</p>'; return; }
            
            const purchaseDays = 7;
            const totalSnackCaloriesBudget = currentDER * 0.1 * purchaseDays;
            const productPackCalories = (recommendedProduct.calories_per_gram || 4.0) * (recommendedProduct.pack_weight_g || 50);
            let recommendedPacks = Math.ceil(totalSnackCaloriesBudget / productPackCalories);
            if (recommendedPacks === 0) recommendedPacks = 1;
            
            container.innerHTML = createPurchaseCard(recommendedProduct, recommendedPacks);
        }

        function populateComboRecommendation(recipe) {
            const container = document.getElementById('combo-recommendation-content');
            container.innerHTML = '';
            if (!recipe.recommendedSupplements || recipe.recommendedSupplements.length === 0) {
                return;
            }
            
            let comboHTML = `<div class="combo-recommendation-section"><h4>é»ƒé‡‘æ­æª”åŠ è³¼æ¨è–¦</h4>`;
            recipe.recommendedSupplements.forEach(productId => {
                const product = myProducts[productId];
                if (product) {
                    comboHTML += createPurchaseCard(product);
                }
            });
            comboHTML += `</div>`;
            container.innerHTML = comboHTML;
        }

        document.addEventListener('click', (e) => {
            if (e.target.matches('.add-to-list-btn')) {
                const card = e.target.closest('.purchase-card');
                if (!card) return;
                const productId = card.dataset.productId;
                const qty = parseInt(card.querySelector('.quantity').textContent);
                addToShoppingList(productId, qty);
            } else if (e.target.matches('.quantity-btn')) {
                const card = e.target.closest('.purchase-card');
                if (!card) return;
                const productId = card.dataset.productId;
                const product = myProducts[productId];
                if (!product) return;
                const action = e.target.dataset.action;
                const quantitySpan = card.querySelector('.quantity');
                const priceSpan = card.querySelector('.total-price');
                let qty = parseInt(quantitySpan.textContent);
                if (action === 'plus') qty++;
                if (action === 'minus' && qty > 1) qty--;
                quantitySpan.textContent = qty;
                priceSpan.textContent = `NT$ ${qty * product.price}`;
            }
        });

        function addToShoppingList(productId, quantity) {
            const product = myProducts[productId];
            if (!product) return;
            const existingItem = shoppingList.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                shoppingList.push({ id: productId, name: product.name, price: product.price, quantity: quantity });
            }
            renderShoppingList();
            shoppingListModal.classList.add('show');
        }

        function renderShoppingList() {
            if (shoppingList.length === 0) {
                listModalBody.innerHTML = '';
                emptyListMsg.style.display = 'block';
            } else {
                emptyListMsg.style.display = 'none';
                listModalBody.innerHTML = shoppingList.map(item => `
                    <div class="list-item" data-id="${item.id}">
                        <div class="list-item-name">${item.name}</div>
                        <div class="quantity-selector">
                            <button class="quantity-btn" data-action="minus">-</button>
                            <span class="quantity">${item.quantity}</span>
                            <button class="quantity-btn" data-action="plus">+</button>
                        </div>
                        <div class="list-item-price">NT$ ${item.price * item.quantity}</div>
                        <button class="list-item-remove" data-action="remove">ç§»é™¤</button>
                    </div>
                `).join('');
            }
            const total = shoppingList.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            listTotalPrice.textContent = `ç¸½è¨ˆ: NT$ ${total}`;
            const totalItems = shoppingList.reduce((sum, item) => sum + item.quantity, 0);
            shoppingListBadge.textContent = totalItems;
            shoppingListBadge.style.display = totalItems > 0 ? 'flex' : 'none';
        }

        function handleListAction(e) {
            if (!e.target.dataset.action) return;
            const action = e.target.dataset.action;
            const listItem = e.target.closest('.list-item');
            if (!listItem) return;
            const productId = listItem.dataset.id;
            const itemIndex = shoppingList.findIndex(item => item.id === productId);
            if (itemIndex === -1) return;

            if (action === 'plus') {
                shoppingList[itemIndex].quantity++;
            } else if (action === 'minus') {
                if (shoppingList[itemIndex].quantity > 1) {
                    shoppingList[itemIndex].quantity--;
                } else {
                    shoppingList.splice(itemIndex, 1);
                }
            } else if (action === 'remove') {
                shoppingList.splice(itemIndex, 1);
            }
            renderShoppingList();
        }

        function handleCheckout() {
            if (shoppingList.length === 0) {
                alert('æ‚¨çš„æ¡è³¼æ¸…å–®æ˜¯ç©ºçš„ï¼');
                return;
            }
            const total = shoppingList.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            alert(`æ„Ÿè¬æ‚¨é€é pp pawfact è¨‚è³¼ï¼\nç¸½é‡‘é¡ç‚º NT$ ${total}\n(æ­¤ç‚ºæ¨¡æ“¬çµå¸³ï¼Œæ‚¨å¯ä»¥å°‡æ­¤è™•æ”¹ç‚ºè·³è½‰è‡³æ‚¨çš„è³¼ç‰©ç¶²ç«™)`);
            shoppingList = [];
            renderShoppingList();
            shoppingListModal.classList.remove('show');
        }

        function handleEmailSubmit(e) {
            e.preventDefault();
            const email = document.getElementById('email-input').value;
            if(email) {
                alert(`æ„Ÿè¬æ‚¨çš„è¨‚é–±ï¼\nå°ˆå±¬è¨ˆç•«å°‡æœƒå¯„é€åˆ°ï¼š${email}\n(æ­¤ç‚ºæ¨¡æ“¬åŠŸèƒ½ï¼Œæœªä¾†å¯å°æ¥å¾Œç«¯ Email æœå‹™)`);
                document.getElementById('email-input').value = '';
            }
        }

        function updateSnackUnit() {
            const selectedSnackKey = snackElements.select.value;
            snackElements.unit.textContent = snackData[selectedSnackKey].unit;
        }

        function calculateSnacks() {
            if (currentDER === 0) { snackElements.result.innerHTML = `<span class="danger">è«‹å…ˆç”¢ç”Ÿä¸€ä»½ä¸»é£Ÿè­œï¼Œæ‰èƒ½è©•ä¼°é›¶é£Ÿå½±éŸ¿ï¼</span>`; return; }
            const snackKey = snackElements.select.value;
            const quantity = parseFloat(snackElements.quantity.value);
            const snack = snackData[snackKey];
            if (isNaN(quantity) || quantity <= 0) { snackElements.result.innerHTML = `<span class="danger">è«‹è¼¸å…¥æœ‰æ•ˆçš„é›¶é£Ÿæ•¸é‡ã€‚</span>`; return; }
            const snackCalories = snack.calories * quantity;
            const percentage = (snackCalories / currentDER) * 100;
            const recommendedLimit = currentDER * 0.1;
            let resultHTML = `é€™ä»½é›¶é£Ÿç´„ <strong>${snackCalories.toFixed(0)} kcal</strong>ï¼Œä½”æ¯æ—¥ç¸½ç†±é‡éœ€æ±‚çš„ <strong>${percentage.toFixed(1)}%</strong>ã€‚`;
            if (percentage > 10) {
                resultHTML += `<br><span class="danger">âš ï¸ è­¦å‘Šï¼šå·²è¶…éæ¯æ—¥é›¶é£Ÿå»ºè­°ç†±é‡ä¸Šé™ (${recommendedLimit.toFixed(0)} kcal)ã€‚è«‹è€ƒæ…®æ¸›å°‘ä¸»é£Ÿä»½é‡æˆ–æ¸›å°‘é›¶é£Ÿã€‚</span>`;
            } else {
                resultHTML += `<br><span class="safe">âœ… åœ¨å»ºè­°çš„10%ç¯„åœå…§ï¼Œå¾ˆæ£’çš„æ§åˆ¶ï¼</span>`;
            }
            snackElements.result.innerHTML = resultHTML;
        }

        function populateRotationSuggestions(currentRecipeId) {
            rotationList.innerHTML = '';
            const selectedTag = formElements.healthIssue.value;
            const selectedAllergens = Array.from(formElements.allergenFilter.querySelectorAll('input:checked')).map(cb => cb.value);
            let suggestionsCount = 0;
            for (const recipeId in recipes) {
                if (recipeId === currentRecipeId || suggestionsCount >= 2) continue;
                const recipe = recipes[recipeId];
                const hasTag = recipe.tags.includes(selectedTag);
                const hasAllergen = recipe.ingredients.some(ingredient => ingredient.allergen_id && selectedAllergens.includes(ingredient.allergen_id));
                if (hasTag && !hasAllergen) {
                    const li = document.createElement('li');
                    const button = document.createElement('button');
                    button.innerHTML = `<strong>${recipe.name}</strong><span>${recipe.description}</span>`;
                    button.onclick = () => {
                        formElements.recipeChoice.value = recipeId;
                        handleFormSubmit();
                        document.getElementById('recipe-title').scrollIntoView({ behavior: 'smooth' });
                    };
                    li.appendChild(button);
                    rotationList.appendChild(li);
                    suggestionsCount++;
                }
            }
            if (suggestionsCount === 0) {
                rotationList.innerHTML = '<li>æ²’æœ‰å…¶ä»–ç¬¦åˆæ¢ä»¶çš„é£Ÿè­œå¯ä¾›è¼ªæ›¿ã€‚</li>';
            }
        }
        
        function updateSupplementsTable(DER, dogWeight, recipe) {
            const supplementsTbody = document.querySelector('#supplements-table tbody');
            supplementsTbody.innerHTML = '';

            // Hide supplements for supplementary meals
            if (recipe.specialNote && recipe.specialNote.includes("è¼”åŠ©é£Ÿç™‚é¤")) {
                supplementsTbody.innerHTML = `<tr><td colspan="4" style="text-align:center; font-weight:bold;">æ­¤ç‚ºè¼”åŠ©é£Ÿç™‚é¤ï¼Œä¸éœ€é¡å¤–æ·»åŠ ä¸»é£Ÿç”¨çš„å¿…éœ€ç‡Ÿé¤Šè£œå……å“ã€‚è«‹ç¢ºä¿ç‹—ç‹—çš„ä¸»é£Ÿæœ¬èº«ç‡Ÿé¤Šå‡è¡¡ã€‚</td></tr>`;
                return;
            }

            const requiredCalciumG = (DER / 1000) * 1.25;
            const eggshellPowderG = requiredCalciumG / 0.37;
            const requiredChickenNecksG = (requiredCalciumG / 1.4) * 100;
            supplementsTbody.innerHTML += `<tr><td data-label="è£œå……å“">é£Ÿå“ç´šè›‹æ®¼ç²‰</td><td data-label="å»ºè­°ä»½é‡">${eggshellPowderG.toFixed(2)} g</td><td data-label="èªªæ˜">æä¾›å¿…éœ€çš„éˆ£è³ªï¼Œå¹³è¡¡éˆ£ç£·æ¯”ï¼Œä¿è­·éª¨éª¼å¥åº·ã€‚</td><td data-label="æ›ç®—åƒè€ƒ">è‹¥æƒ³é€é<strong>ç£¨ç¢çš„ç”Ÿé›è„–</strong>è£œå……ï¼Œç´„éœ€ <strong>${Math.round(requiredChickenNecksG)} å…‹</strong>ã€‚<span class="warning">âš ï¸æ³¨æ„ï¼šé€™æœƒé¡å¤–å¢åŠ ç´„ ${Math.round(requiredChickenNecksG * 2.3)} å¤§å¡ç†±é‡ï¼Œä¸”æœ‰éª¨åˆºé¢¨éšªã€‚</span></td></tr>`;
            const requiredOmega3mg = dogWeight * 60;
            const requiredSalmonG = (requiredOmega3mg / 1800) * 100;
            supplementsTbody.innerHTML += `<tr><td data-label="è£œå……å“">é«˜å“è³ªé­šæ²¹</td><td data-label="å»ºè­°ä»½é‡">ç´„ ${Math.round(requiredOmega3mg)} mg çš„ EPA+DHA</td><td data-label="èªªæ˜">æŠ—ç™¼ç‚ã€è­·å¿ƒã€äº®æ¯›ã€‚è«‹ä¾æ‚¨ç”¢å“çš„æ¿ƒåº¦æ›ç®—ã€‚</td><td data-label="æ›ç®—åƒè€ƒ">è‹¥æƒ³é€é<strong>é¤Šæ®–é®­é­š</strong>è£œå……ï¼Œç´„éœ€ <strong>${Math.round(requiredSalmonG)} å…‹</strong>ã€‚<span class="warning">âš ï¸æ³¨æ„ï¼šé€™æœƒé¡å¤–å¢åŠ ç´„ ${Math.round(requiredSalmonG * 2.08)} å¤§å¡ç†±é‡ï¼Œä¸¦å¯èƒ½æ”å…¥é‡é‡‘å±¬ã€‚</span></td></tr>`;
            if (recipe.specialSupplements && recipe.specialSupplements.includes('glucosamine')) {
                const glucosamineMg = dogWeight * 25;
                const requiredChickenFeetG = (glucosamineMg / 400) * 100;
                supplementsTbody.innerHTML += `<tr><td data-label="è£œå……å“">è‘¡è„ç³–èƒº/è»Ÿéª¨ç´ </td><td data-label="å»ºè­°ä»½é‡">ç´„ ${Math.round(glucosamineMg)}+ mg</td><td data-label="èªªæ˜">ç¶­è­·é—œç¯€å¥åº·ï¼Œå»ºè­°ä½¿ç”¨è¤‡åˆé…æ–¹ç”¢å“ã€‚</td><td data-label="æ›ç®—åƒè€ƒ">è‹¥æƒ³é€é<strong>é›è…³</strong>è£œå……ï¼Œç´„éœ€ <strong>${Math.round(requiredChickenFeetG)} å…‹</strong>ã€‚<span class="warning">âš ï¸æ³¨æ„ï¼šé€™æœƒé¡å¤–å¢åŠ ç´„ ${Math.round(requiredChickenFeetG * 2.15)} å¤§å¡ç†±é‡ï¼Œä¸”å«é‡ä¸ç©©å®šã€‚</span></td></tr>`;
            }
            if (recipe.specialSupplements && recipe.specialSupplements.includes('taurine')) {
                const taurineMg = dogWeight * 30;
                const requiredChickenHeartG = (taurineMg / 170) * 100;
                supplementsTbody.innerHTML += `<tr><td data-label="è£œå……å“">ç‰›ç£ºé…¸ (Taurine)</td><td data-label="å»ºè­°ä»½é‡">ç´„ ${Math.round(taurineMg)}-${Math.round(taurineMg*2)} mg</td><td data-label="èªªæ˜">æ”¯æŒå¿ƒè‚ŒåŠŸèƒ½ï¼Œå°é«˜é½¡çŠ¬å’Œç‰¹å®šå“ç¨®å°¤å…¶é‡è¦ã€‚</td><td data-label="æ›ç®—åƒè€ƒ">è‹¥æƒ³é€é<strong>é›å¿ƒ</strong>è£œå……ï¼Œç´„éœ€ <strong>${Math.round(requiredChickenHeartG)} å…‹</strong>ã€‚<span class="warning">âš ï¸æ³¨æ„ï¼šé€™æœƒé¡å¤–å¢åŠ ç´„ ${Math.round(requiredChickenHeartG * 1.53)} å¤§å¡ç†±é‡ï¼Œä¸”çƒ¹ç…®æœƒå¤§é‡æµå¤±ã€‚</span></td></tr>`;
            }
            supplementsTbody.innerHTML += `<tr><td data-label="è£œå……å“">çŠ¬ç”¨ç¶œåˆç¶­ç”Ÿç´ ç¤¦ç‰©è³ª</td><td data-label="å»ºè­°ä»½é‡">ä¾ç”¢å“èªªæ˜</td><td data-label="èªªæ˜"><strong>(å¼·çƒˆå»ºè­°)</strong> è£œè¶³è‡ªè£½é®®é£Ÿå¯èƒ½ç¼ºä¹çš„å¾®é‡å…ƒç´  (å¦‚é‹…ã€ç¢˜ã€ç¶­ç”Ÿç´ Eç­‰)ã€‚</td><td data-label="æ›ç®—åƒè€ƒ">ä¾‹å¦‚ï¼Œè£œè¶³é‹…éœ€å¤§é‡<strong>ç‰¡è £</strong>ï¼›è£œç¢˜å‰‡éœ€<strong>æµ·å¸¶</strong>ã€‚<span class="warning">âš ï¸æ³¨æ„ï¼šè‡ªè¡Œæ­é…æ¥µå…¶å›°é›£ä¸”æœ‰ä¸­æ¯’é¢¨éšªã€‚é€™æ˜¯æœ€å»ºè­°ä½¿ç”¨å°ˆæ¥­è£œå……å“çš„é …ç›®ã€‚</span></td></tr>`;
        }
        function calculateBatch() {
            const days = parseInt(document.getElementById('batch-days').value);
            if (isNaN(days) || days < 1) { alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„å¤©æ•¸ã€‚'); return; }
            let ingredientsHtml = '<h4>é£Ÿæç¸½é‡ï¼š</h4><ul>';
            const ingredientsRows = document.querySelectorAll('#ingredients-table tbody tr');
            ingredientsRows.forEach(row => {
                const name = row.cells[0].textContent;
                const dailyWeight = parseFloat(row.cells[1].textContent);
                ingredientsHtml += `<li><strong>${name}:</strong> ${(dailyWeight * days).toFixed(1)} g</li>`;
            });
            ingredientsHtml += '</ul>';
            let supplementsHtml = '<h4>ç‡Ÿé¤Šè£œå……å“ç¸½é‡ï¼š</h4><ul>';
            const supplementsRows = document.querySelectorAll('#supplements-table tbody tr');
            supplementsRows.forEach(row => {
                const name = row.cells[0].textContent;
                const dailyAmountText = row.cells[1].textContent;
                const dailyAmount = parseFloat(dailyAmountText);
                if (!isNaN(dailyAmount)) {
                    supplementsHtml += `<li><strong>${name}:</strong> ${(dailyAmount * days).toFixed(2)} ${dailyAmountText.replace(/[0-9.]/g, '').trim()}</li>`;
                } else {
                    supplementsHtml += `<li><strong>${name}:</strong> ${dailyAmountText} (æ¯æ—¥æ·»åŠ )</li>`;
                }
            });
            supplementsHtml += '</ul><p><strong>ä¿å­˜æç¤ºï¼š</strong>å»ºè­°å°‡æ¯æ—¥ä»½é‡åˆ†è£ï¼Œå†·è—å¯ä¿å­˜3å¤©ï¼Œå…¶é¤˜å†·å‡å¯ä¿å­˜1å€‹æœˆã€‚</p>';
            document.getElementById('batch-result').innerHTML = ingredientsHtml + supplementsHtml;
        }

    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'991f48963df0e2f0',t:'MTc2MTAzNDI3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
